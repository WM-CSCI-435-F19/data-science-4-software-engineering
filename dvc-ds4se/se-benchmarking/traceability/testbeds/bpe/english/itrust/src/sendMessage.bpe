▁<%@ page ▁import =" edu . nc su . cs c . itrust . action . S endMessageAction "%> ▁<%@ page ▁import =" edu . nc su . cs c . itrust . beans . MessageBean "%> ▁<%@ page ▁import =" edu . nc su . cs c . itrust . beans . PatientBean "%> ▁<%@ page ▁import =" edu . nc su . cs c . itrust . beans . PersonnelBean "%> ▁<%@ page ▁import =" edu . nc su . cs c . itrust . exception . FormValidat ionException "%> ▁<%@ page ▁import =" java . util . List "%> ▁<%@ tag lib ▁uri ="/ W EB - INF / tags . tld " ▁prefix =" itrust " ▁%> ▁<%@ page ▁error Page ="/ auth / exception Handler . jsp " ▁%> ▁<%@ include ▁file ="/ global . jsp "%> ▁<% ▁pageTitle ▁= ▁" iTrust ▁- ▁Send ▁a ▁Message "; ▁%> ▁<%@ include ▁file ="/ header . jsp "%> ▁<% ▁S endMessageAction ▁action ▁= ▁new ▁S endMessageAction ( prodDAO , ▁loggedInMID . longValue ()); ▁int ▁index ; ▁int ▁ dlhcpIndex ▁= ▁-1; ▁int ▁ representeeIndex ▁= ▁-1; ▁int ▁ repDLHCPIndex ▁= ▁-1; ▁if ▁( request . getParameter (" sendMessage ") ▁ != ▁null ▁&& ▁request . getParameter (" sendMessage "). equals (" Send ")) ▁{ ▁try ▁{ ▁MessageBean ▁message ▁= ▁new ▁MessageBean (); ▁message . set From ( loggedInMID . longValue ()); ▁message . setTo ( ( ( PersonnelBean ) session . get Attribute (" dlhcp ")) . get MID ()); ▁message . s etBody ( request . getParameter (" message Body ")); ▁message . set Subject ( request . getParameter (" subject ")); ▁message . set Read (0); ▁action . sendMessage ( message ); ▁session . remove Attribute (" dlhcp "); ▁response . send Redirect (" message Outbox . jsp "); ▁} ▁catch ▁( FormValidat ionException ▁e ){ ▁%> ▁< div ▁align = center >< span ▁class =" iTrust Error "><%= e . getMessage ()%></ span ></ div > ▁<% ▁} ▁} ▁if ▁( request . getParameter (" select DLHCP ") ▁ != ▁null ▁&& ▁request . getParameter (" select DLHCP "). equals (" Select ")) ▁{ ▁if ▁( request . getParameter (" dlhcp ") ▁ != ▁null ▁&& ▁! request . getParameter (" dlhcp "). equals (" -1 ")) ▁ dlhcpIndex ▁= ▁Integer . parse Int ( request . getParameter (" dlhcp ")); ▁} ▁else ▁if ▁( request . getParameter (" selectRep DLHCP ") ▁ != ▁null ▁&& ▁request . getParameter (" selectRep DLHCP "). equals (" Select ")) ▁{ ▁if ▁( request . getParameter (" representee ") ▁ != ▁null ▁&& ▁! request . getParameter (" representee "). equals (" -1 ")) ▁ representeeIndex ▁= ▁Integer . parse Int ( request . getParameter (" representee ")); ▁if ▁( request . getParameter (" repDLHCP ") ▁ != ▁null ▁&& ▁! request . getParameter (" repDLHCP "). equals (" -1 ")) ▁ repDLHCPIndex ▁= ▁Integer . parse Int ( request . getParameter (" repDLHCP ")); ▁} ▁else ▁if ▁( request . getParameter (" selectRep ") ▁ != ▁null ▁&& ▁request . getParameter (" selectRep "). equals (" Select ")) ▁{ ▁if ▁( request . getParameter (" representee ") ▁ != ▁null ▁&& ▁! request . getParameter (" representee "). equals (" -1 ")) ▁ representeeIndex ▁= ▁Integer . parse Int ( request . getParameter (" representee ")); ▁} ▁%> ▁< div ▁align =" left "> ▁< form ▁id =" mainForm " ▁method =" get " ▁action =" sendMessage . jsp "> ▁< h 2> Send ▁a ▁Message </ h 2> ▁<% ▁if ▁( dlhcpIndex ▁== ▁-1 ▁&& ▁ representeeIndex ▁== ▁-1) ▁{ ▁%> ▁<% ▁List < PersonnelBean > ▁dlhcps ▁= ▁action . getMy DLHCPs (); ▁List < PatientBean > ▁representees ▁= ▁action . getMy Representees (); ▁session . set Attribute (" dlhcp s ", ▁dlhcps ); ▁session . set Attribute (" representees ", ▁representees ); ▁%> ▁< h 4> To ▁One ▁of ▁My ▁ DLHCPs </ h 4> ▁<% ▁if ▁( dlhcp s . size () ▁> ▁0) ▁{ ▁%> ▁< select ▁name =" dlhcp "> ▁< option ▁value =" -1 "></ option > ▁<% ▁index ▁= ▁0; ▁%> ▁<% ▁for ( PersonnelBean ▁dlhcp ▁: ▁dlhcps ) ▁{ ▁%> ▁< option ▁value ="<%= ▁index ▁%>"><%= ▁dlhcp . getF ullName () ▁%></ option > ▁<% ▁index ▁++; ▁%> ▁<% ▁} ▁%> ▁</ select > ▁< input ▁type =" submit " ▁value =" Select " ▁name =" select DLHCP "/> ▁<% ▁} ▁else ▁{ ▁%> ▁< i > You ▁have n ' t ▁declared ▁any ▁HCPs . </ i > ▁<% ▁} ▁%> ▁< h 4> On ▁Be h al f ▁of ▁One ▁of ▁My ▁ Representees </ h 4> ▁<% ▁if ▁( representees . size () ▁> ▁0) ▁{ ▁%> ▁< select ▁name =" representee "> ▁< option ▁value =" -1 "></ option > ▁<% ▁index ▁= ▁0; ▁%> ▁<% ▁for ( PatientBean ▁representee ▁: ▁representees ) ▁{ ▁%> ▁< option ▁value ="<%= ▁index ▁%>"><%= ▁representee . getF ullName () ▁%></ option > ▁<% ▁index ▁++; ▁%> ▁<% ▁} ▁%> ▁</ select > ▁< input ▁type =" submit " ▁value =" Select " ▁name =" selectRep "/> ▁<% ▁} ▁else ▁{ ▁%> ▁< i > No ▁other ▁patients ▁have ▁declared ▁you ▁as ▁a ▁representative . </ i > ▁<% ▁} ▁%> ▁<% ▁} ▁else ▁if ▁( dlhcpIndex ▁>= ▁0) ▁{ ▁%> ▁<% ▁List < PersonnelBean > ▁dlhcps ▁= ▁( List < PersonnelBean > ) ▁session . get Attribute (" dlhcp s "); ▁PersonnelBean ▁dlhcp ▁= ▁dlhcps . get ( dlhcpIndex ); ▁session . set Attribute (" dlhcp ", ▁dlhcp ); ▁%> ▁< h 4> To ▁<%= ▁dlhcp . getF ullName () ▁%></ h 4> ▁< span > Subject : ▁</ span >< input ▁type =" text " ▁name =" subject " ▁size ="50 " ▁/>< br ▁/>< br ▁/> ▁< span > Message : ▁</ span >< br ▁/> ▁< textarea ▁name =" message Body " ▁cols ="100 " ▁rows ="10"> </ textarea >< br ▁/> ▁< br ▁/> ▁< input ▁type =" submit " ▁value =" Send " ▁name =" sendMessage "/> ▁<% ▁} ▁else ▁if ▁( repDLHCPIndex ▁>= ▁0) ▁{ ▁%> ▁<% ▁List < PersonnelBean > ▁repDLHCPs ▁= ▁( List < PersonnelBean > ) ▁session . get Attribute (" repDLHCP s "); ▁PersonnelBean ▁dlhcp ▁= ▁repDLHCPs . get ( repDLHCPIndex ); ▁session . set Attribute (" dlhcp ", ▁dlhcp ); ▁List < PatientBean > ▁representees ▁= ▁( List < PatientBean > ) ▁session . get Attribute (" representees "); ▁PatientBean ▁representee ▁= ▁representees . get ( representeeIndex ); ▁%> ▁< h 4> To ▁<%= ▁dlhcp . getF ullName () ▁%> ▁on ▁Be h al f ▁of ▁<%= ▁representee . getF ullName () ▁%></ h 4> ▁< span > Subject : ▁</ span >< input ▁type =" text " ▁name =" subject " ▁size ="50 " ▁/>< br ▁/>< br ▁/> ▁< span > Message : ▁</ span >< br ▁/> ▁< textarea ▁name =" message Body " ▁cols ="100 " ▁rows ="10"> </ textarea >< br ▁/> ▁< br ▁/> ▁< input ▁type =" submit " ▁value =" Send " ▁name =" sendMessage "/> ▁<% ▁} ▁else ▁if ▁( representeeIndex ▁>= ▁0) ▁{ ▁%> ▁<% ▁List < PatientBean > ▁representees ▁= ▁( List < PatientBean > ) ▁session . get Attribute (" representees "); ▁PatientBean ▁representee ▁= ▁representees . get ( representeeIndex ); ▁List < PersonnelBean > ▁repDLHCPs ▁= ▁action . get DLHCPs For ( representee . get MID ()); ▁session . set Attribute (" repDLHCP s ", ▁repDLHCPs ); ▁%> ▁< h 4> To ▁One ▁of ▁<%= ▁representee . getF ullName () ▁%> ' s ▁ DLHCPs </ h 4> ▁< input ▁type =" hidden " ▁name =" representee " ▁value ="<%= ▁ representeeIndex ▁%> "/> ▁<% ▁if ▁( repDLHCP s . size () ▁> ▁0) ▁{ ▁%> ▁< select ▁name =" repDLHCP "> ▁< option ▁value =" -1 "></ option > ▁<% ▁index ▁= ▁0; ▁%> ▁<% ▁for ( PersonnelBean ▁ repDLHCP ▁: ▁repDLHCPs ) ▁{ ▁%> ▁< option ▁value ="<%= ▁index ▁%>"><%= ▁ repDLHCP . getF ullName () ▁%></ option > ▁<% ▁index ▁++; ▁%> ▁<% ▁} ▁%> ▁</ select > ▁< input ▁type =" submit " ▁value =" Select " ▁name =" selectRep DLHCP "/> ▁<% ▁} ▁else ▁{ ▁%> ▁< i ><%= ▁representee . getF ullName () ▁%> ▁has ▁not ▁declared ▁any ▁HCPs . </ i > ▁<% ▁} ▁%> ▁<% ▁} ▁%> ▁</ form > ▁</ div > ▁<%@ include ▁file ="/ f ooter . jsp "%>