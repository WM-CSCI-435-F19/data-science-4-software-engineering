▁<%@ tag lib ▁uri ="/ W EB - INF / tags . tld " ▁prefix =" itrust " ▁%> ▁<%@ page ▁error Page ="/ auth / exception Handler . jsp " ▁%> ▁<%@ page ▁import =" java . util . ArrayList "%> ▁<%@ page ▁import =" java . util . Date "%> ▁<%@ page ▁import =" java . util . List "%> ▁<%@ page ▁import =" java . text . DateFormat "%> ▁<%@ page ▁import =" edu . nc su . cs c . itrust . action . EditPHR Action "%> ▁<%@ page ▁import =" edu . nc su . cs c . itrust . dao . DAOFactory "%> ▁<%@ page ▁import =" edu . nc su . cs c . itrust . beans . PatientBean "%> ▁<%@ page ▁import =" edu . nc su . cs c . itrust . beans . AllergyBean "%> ▁<%@ page ▁import =" edu . nc su . cs c . itrust . beans . FamilyMemberBean "%> ▁<%@ page ▁import =" edu . nc su . cs c . itrust . beans . HealthRecord "%> ▁<%@ page ▁import =" edu . nc su . cs c . itrust . beans . OfficeVisitBean "%> ▁<%@ page ▁import =" edu . nc su . cs c . itrust . beans . ProcedureBean "%> ▁<%@ page ▁import =" edu . nc su . cs c . itrust . risk . RiskChecker "%> ▁<%@ page ▁import =" edu . nc su . cs c . itrust . beans . PersonnelBean "%> ▁<%@ page ▁import =" edu . nc su . cs c . itrust . dao . mysql . PersonnelDAO "%> ▁<%@ page ▁import =" edu . nc su . cs c . itrust . dao . mysql . PatientDAO "%> ▁<%@ include ▁file ="/ global . jsp " ▁%> ▁<% ▁pageTitle ▁= ▁" iTrust ▁- ▁Edit ▁Personal ▁Health ▁Record "; ▁%> ▁<%@ include ▁file ="/ header . jsp " ▁%> ▁<% ▁PatientDAO ▁patientDAO ▁= ▁new ▁PatientDAO ( prodDAO ); ▁PersonnelDAO ▁personnelDAO ▁= ▁new ▁PersonnelDAO ( prodDAO ); ▁PersonnelBean ▁personnelb ▁= ▁personnelDAO . getPersonnel ( loggedInMID . longValue ()); ▁DateFormat ▁ df ▁= ▁DateFormat . getDate Instance (); ▁String ▁switch String ▁= ▁""; ▁if ▁( request . getParameter (" switch ") ▁ != ▁null ) ▁{ ▁switch String ▁= ▁request . getParameter (" switch "); ▁} ▁String ▁ relativeString ▁= ▁""; ▁if ▁( request . getParameter (" relative ") ▁ != ▁null ) ▁{ ▁ relativeString ▁= ▁request . getParameter (" relative "); ▁} ▁String ▁patient String ▁= ▁""; ▁if ▁( request . getParameter (" patient ") ▁ != ▁null ) ▁{ ▁patient String ▁= ▁request . getParameter (" patient "); ▁} ▁String ▁pidString ; ▁if ▁( switch String . equals (" true ")) ▁pidString ▁= ▁""; ▁else ▁if ▁(! relativeString . equals ("")) ▁{ ▁int ▁relative Index ▁= ▁Integer . parse Int ( relativeString ); ▁List < PatientBean > ▁relative s ▁= ▁( List < PatientBean > ) ▁session . get Attribute (" relative s "); ▁pidString ▁= ▁"" ▁+ ▁relative s . get ( relative Index ) . get MID (); ▁session . remove Attribute (" relative s "); ▁session . set Attribute (" pid ", ▁pidString ); ▁} ▁else ▁if ▁(! patient String . equals ("")) ▁{ ▁int ▁ patientIndex ▁= ▁Integer . parse Int ( patient String ); ▁List < PatientBean > ▁patients ▁= ▁( List < PatientBean > ) ▁session . get Attribute (" patients "); ▁pidString ▁= ▁"" ▁+ ▁patients . get ( patientIndex ) . get MID (); ▁session . remove Attribute (" patients "); ▁session . set Attribute (" pid ", ▁pidString ); ▁} ▁else ▁pidString ▁= ▁( String ) session . get Attribute (" pid "); ▁if ▁( pidString ▁== ▁null ▁|| ▁1 ▁> ▁pidString . length ()) ▁{ ▁response . send Redirect (" . . / getPatientID . jsp ? forward = hcp - uap / e ditPHR . jsp "); ▁return ; ▁} ▁// else ▁{ ▁// ▁session . remove Attribute (" pid "); ▁// } ▁EditPHRAction ▁action ▁= ▁new ▁EditPHRAction ( prodDAO , loggedInMID . longValue (), ▁pidString ); ▁long ▁pid ▁= ▁action . get Pid (); ▁String ▁confirm ▁= ▁action . update Allergies ( pid , request . getParameter (" description ")); ▁PatientBean ▁patient ▁= ▁action . getPatient (); ▁List < HealthRecord > ▁records ▁= ▁action . getAll HealthRecords (); ▁HealthRecord ▁ mostRecent ▁= ▁records . size () ▁> ▁0 ▁? ▁records . get (0) ▁: ▁null ; ▁List < OfficeVisitBean > ▁officeVisits ▁= ▁action . get AllOfficeVisits (); ▁List < FamilyMemberBean > ▁family ▁= ▁action . get Family (); ▁%> ▁<%@ page ▁import =" edu . nc su . cs c . itrust . exception . No HealthRecords Exception "%> < script ▁type =" text / javascript "> ▁function ▁show Risk s ( ){ ▁document . getElementById (" risk s "). style . display =" in line "; ▁document . getElementById (" risk Button "). style . display =" none "; ▁} ▁</ script > ▁<% ▁if ▁(!" " . equals ( confirm )) ▁{%> ▁< span ▁><%= confirm %></ span >< br ▁/> ▁<% ▁} ▁%> ▁< br ▁/> ▁< div ▁align = center > ▁< div ▁ style =" margin - right : ▁10 px ; ▁display : ▁inline - table ;"> ▁< table ▁class =" f Table " ▁align =" center "> ▁< tr > ▁< th ▁col span ="2"> Patient ▁Information </ th > ▁</ tr > ▁< tr > ▁< td ▁class =" subHeader V ertical "> Name :</ td > ▁< td ▁><%= patient . getF ullName ()%></ td > ▁</ tr > ▁< tr > ▁< td ▁class =" subHeader V ertical "> Address :</ td > ▁< td ▁> ▁<%= patient . getStreetAddress 1()%>< br ▁/> ▁<% =" " . equals ( patient . getStreetAddress 2 ()) ▁? ▁"" ▁: ▁patient . getStreetAddress 2() ▁+ ▁"< br ▁/> "%> ▁<%= patient . getStreetAddress 3 ()%>< br ▁/> ▁</ td > ▁</ tr > ▁< tr > ▁< td ▁class =" subHeader V ertical "> Phone :</ td > ▁< td ▁><%= patient . getPhone ()%></ td > ▁</ tr > ▁< tr > ▁< td ▁class =" subHeader V ertical " ▁> Email :</ td > ▁< td ▁><%= patient . getEmail ()%></ td > ▁</ tr > ▁< tr > ▁< th ▁col span ="2"> I nsurance ▁Information </ th > ▁</ tr > ▁< tr > ▁< td ▁class =" subHeader V ertical " ▁> Pro v i der ▁Name :</ td > ▁< td ▁><%= patient . getIc Name ()%></ td > ▁</ tr > ▁< tr > ▁< td ▁class =" subHeader V ertical "> Address :</ td > ▁< td ▁> ▁<%= patient . getIcAddress 1()%>< br ▁/> ▁<% =" " . equals ( patient . getIcAddress 2 ()) ▁? ▁"" ▁: ▁patient . getIcAddress 2() ▁+ ▁"< br ▁/> "%> ▁<%= patient . getIcAddress 3 ()%>< br ▁/> ▁</ td > ▁</ tr > ▁< tr > ▁< td ▁class =" subHeader V ertical "> Phone :</ td > ▁< td ▁><%= patient . getIcPhone ()%></ td > ▁</ tr > ▁</ table > ▁< br ▁/> ▁< a ▁href =" editPatient . jsp " ▁ style =" text - deco ration : ▁none ;"> ▁< input ▁type = button ▁value =" Edit " ▁on Click =" location =' editPatient . jsp ' ;"> ▁</ a > ▁</ div > ▁< div ▁ style =" margin - right : ▁10 px ; ▁display : ▁inline - table ;"> ▁< table ▁class =" f Table " ▁align =" center "> ▁< tr > ▁< th ▁col span ="2"> Basic ▁Health ▁Records </ th > ▁</ tr > ▁<% ▁if ▁( null ▁== ▁ mostRecent ) ▁{ ▁%> ▁< tr >< td ▁col span =2> No ▁basic ▁health ▁records ▁are ▁on ▁file ▁for ▁this ▁patient </ td ></ tr > ▁<% ▁} ▁else ▁{%> ▁< tr > ▁< td ▁class =" subHeader V ertical "> Height :</ td > ▁< td ▁><%= mostRecent . get Height ()%> in . </ td > ▁</ tr > ▁< tr > ▁< td ▁class =" subHeader V ertical "> Weight :</ td > ▁< td ▁><%= mostRecent . get Weight ()%> lbs . </ td > ▁</ tr > ▁< tr > ▁< td ▁class =" subHeader V ertical "> Smoker ? :</ td > ▁< td ▁><%= mostRecent . isSmoker () ▁? ▁" Yes " ▁: ▁" No "%></ td > ▁</ tr > ▁< tr > ▁< td ▁class =" subHeader V ertical "> Blood ▁Pressure :</ td > ▁< td ▁><%= mostRecent . get BloodPressureN ()%> /<%= mostRecent . get BloodPressureD ()%> mm H g </ td > ▁</ tr > ▁< tr > ▁< td ▁class =" subHeader V ertical "> Cholesterol :</ td > ▁< td ▁> ▁< table > ▁< tr > ▁< td ▁ style =" text - align : ▁right "> HDL :</ td > ▁< td ><%= mostRecent . get CholesterolHDL ()%> ▁mg / dL </ td > ▁</ tr > ▁< tr > ▁< td ▁ style =" text - align : ▁right "> LDL :</ td > ▁< td ><%= mostRecent . get CholesterolLDL ()%> ▁mg / dL </ td > ▁</ tr > ▁< tr > ▁< td ▁ style =" text - align : ▁right "> T ri :</ td > ▁< td ><%= mostRecent . get CholesterolTri ()%> ▁mg / dL </ td > ▁</ tr > ▁< tr > ▁< td ▁ style =" text - align : ▁right "> Total :</ td > ▁< td > ▁< span ▁id =" total Span " ▁ style =" font - weight : ▁bold ; ▁color : ▁# 0 0 0 ;"><%= mostRecent . getTotalC holesterol ()%> ▁mg / dL </ span > ▁</ td > ▁</ tr > ▁</ table > ▁</ td > ▁</ tr > ▁<% ▁} ▁// cl o s ing ▁for ▁" ther e ▁is ▁a ▁most ▁recent ▁record ▁for ▁this ▁patient " ▁%> ▁</ table > ▁< br ▁/> ▁< a ▁href =" edit Basic Health . jsp " ▁ style =" text - deco ration : ▁none ;"> ▁< input ▁type =" button " ▁value =" View / Edit ▁History " ▁on Click =" location =' edit Basic Health . jsp ' ;"> ▁</ a > ▁</ div > ▁< div ▁ style =" display : ▁inline - table ;"> ▁< table ▁class =" f Table " ▁align =" center "> ▁< tr > ▁< th > Office ▁Visits </ th > ▁</ tr > ▁< tr > ▁< td ▁align =" center "> ▁< div ▁ style =" over f low : a u to ; ▁height : 200 px ; ▁width : 200 px ;"> ▁<% ▁for ▁( OfficeVisitBean ▁ov ▁: ▁officeVisits ) ▁{ ▁%> ▁< a ▁href =" e ditOfficeVisit . jsp ? ovID =<%= ov . get VisitID ()%>"><%= df . format ( ov . getVisitDate ())%></ a >< br ▁/> ▁<% ▁} ▁%> ▁</ div > ▁</ td > ▁</ tr > ▁</ table > ▁< br ▁/> ▁< a ▁href =" getPrescription Report . jsp " ▁ style =" text - deco ration : ▁none ; " ▁> ▁< input ▁type = button ▁value =" Get ▁Prescription ▁Report " ▁on Click =" location =' getPrescription Report . jsp ' ;"> ▁</ a > ▁</ div > ▁</ div > ▁< br ▁/> ▁< table ▁class =" f Table " ▁align =" center " ▁> ▁< tr > ▁< th ▁col span ="9" > Family ▁Medica l ▁History </ th > ▁</ tr > ▁< tr ▁class =" subHeader "> ▁< td > ▁Name ▁</ td > ▁< td > ▁ Relation ▁</ td > ▁< td > ▁ High ▁Blood ▁Pressure ▁</ td > ▁< td > ▁ High ▁Cholesterol ▁</ td > ▁< td > ▁Diabetes ▁</ td > ▁< td > ▁ Cancer ▁</ td > ▁< td > ▁Heart ▁Disease ▁</ td > ▁< td > ▁ Smoker ▁</ td > ▁< td > ▁ Cause ▁of ▁Death ▁</ td > ▁</ tr > ▁<% ▁if ▁(0 ▁== ▁family . size ()) ▁{%> ▁< tr > ▁< td ▁col span ="9" ▁ style =" text - align : ▁center ;"> No ▁ Relation s ▁on ▁record </ td > ▁</ tr > ▁<% ▁} ▁else ▁{ ▁List < PatientBean > ▁ patientRelatives ▁= ▁new ▁ArrayList < PatientBean > (); ▁int ▁index ▁= ▁0; ▁for ( FamilyMemberBean ▁member ▁: ▁family ) ▁{ ▁ patientRelatives . add ( patientDAO . getPatient ( member . get Mid ()) ); ▁%> ▁< tr > ▁< td ▁class ▁= ▁" value C ell " ▁>< a ▁href =" e ditPHR . jsp ? relative =<%= index %>"><%= member . getF ullName ()%></ a ></ td > ▁< td ▁><%= member . get Relation ()%></ td > ▁< td ▁align = center ><%= action . does FamilyMemberHave High BP ( member ) ▁? ▁" x " ▁: ▁" "%></ td > ▁< td ▁align = center ><%= action . does FamilyMemberHave High Cholesterol ( member ) ▁? ▁" x " ▁: ▁" "%></ td > ▁< td ▁align = center ><%= action . does FamilyMemberHave Diabetes ( member ) ▁? ▁" x " ▁: ▁" "%></ td > ▁< td ▁align = center ><%= action . does FamilyMemberHave Cancer ( member ) ▁? ▁" x " ▁: ▁" "%></ td > ▁< td ▁align = center ><%= action . does FamilyMemberHave HeartDisease ( member ) ▁? ▁" x " ▁: ▁" "%></ td > ▁< td ▁align = center ><%= action . is FamilyMember Smoker ( member ) ▁? ▁" x " ▁: ▁" "%></ td > ▁< td ▁><%= action . get FamilyMember COD ( member )%></ td > ▁</ tr > ▁<% ▁index ++; ▁} ▁session . set Attribute (" relative s ", ▁ patientRelatives ); ▁} ▁%> ▁</ table > ▁< br ▁/> ▁< div ▁align = center > ▁< div ▁ style =" margin - right : ▁10 px ; ▁display : ▁inline - table ;"> ▁<% ▁List < AllergyBean > ▁allergies ▁= ▁action . get Allergies (); ▁%> ▁< table ▁class =" f Table " ▁align =" center " ▁> ▁< tr > ▁< th ▁col span ="2"> Allergies </ th > ▁</ tr > ▁< tr ▁class =" subHeader "> ▁< td > Allergy ▁Description </ td > ▁< td > First ▁Found </ td > ▁</ tr > ▁<% ▁if ▁(0 ▁== ▁allergies . size ()) ▁{ ▁%> ▁< tr > ▁< td ▁col span ="2" ▁ style =" text - align : ▁center ;"> No ▁Allergies ▁on ▁record </ td > ▁</ tr > ▁<% ▁} ▁else ▁{ ▁for ▁( AllergyBean ▁allergy ▁: ▁allergies ) ▁{%> ▁< tr > ▁< td ▁ style =" text - align : ▁center ;"><%= allergy . get Description ()%></ td > ▁< td ▁ style =" text - align : ▁center ;"><%= df . format ( allergy . getFirstFound ())%></ td > ▁</ tr > ▁<% ▁} ▁} ▁%> ▁< form ▁name =" Add Allergy " ▁action =" e ditPHR . jsp " ▁method =" post "> ▁< tr ▁> ▁< th ▁col span ="2" ▁ style =" text - align : ▁center ;"> New </ th > ▁</ tr > ▁< tr > ▁< td ▁col span ="2"> ▁< input ▁type =" text " ▁size =" 30 " ▁maxlength ="50 " ▁name =" description "> ▁< input ▁type =" submit " ▁name =" add A " ▁value =" Add ▁ Allergy "> ▁</ td > ▁</ tr > ▁</ table > ▁</ div > ▁< div ▁ style =" margin - right : ▁10 px ; ▁display : ▁inline - table ;"> ▁< table ▁class =" f Table " ▁align = center > ▁< tr > ▁< th ▁col span =2 ▁ style =" back g round - color : silver ;"> Chronic ▁Disease ▁Risk ▁Factors </ th > ▁</ tr > ▁< tr > ▁< td ▁align =" center "> ▁< div ▁id =" risk s " ▁ style =" display : ▁none ;"> ▁Patient ▁is ▁at ▁risk ▁for ▁the ▁following :< br ▁/> ▁<% ▁try { ▁List < RiskChecker > ▁diseases ▁= ▁action . getDisease sAtRisk (); ▁for ▁( RiskChecker ▁disease ▁: ▁diseases ) ▁{ ▁%> ▁< span ▁><%= disease . getName ()%></ span >< br ▁/> ▁<% ▁} ▁} ▁catch ▁( No HealthRecords Exception ▁e ) ▁{ ▁%><%= e . getMessage ()%> <% ▁} ▁%> ▁< a ▁ style =" font - size : ▁80 %" ▁href =" chronic DiseaseRisks . jsp "> Mo re ▁Information </ a > ▁</ div > ▁</ td > ▁</ tr > ▁</ table > ▁< br ▁/> ▁< div ▁id =" risk Button "> ▁< input ▁type = button ▁value =" S how ▁Chronic ▁Diseases ▁Risk ▁Factors " ▁ onclick =" javascript : show Risk s (); "> ▁</ div > ▁</ div > ▁< div ▁ style =" display : ▁inline - table ;"> ▁< table ▁class =" f Table " ▁align = center > ▁< tr > ▁< th ▁col span ="3" ▁ style =" back g round - color : silver ;"> Immunizations </ th > ▁</ tr > ▁< tr ▁class =" subHeader "> ▁< td > CPT ▁Code </ td > ▁< td > Description </ td > ▁< td > Date ▁ Received </ td > ▁</ tr > ▁<% ▁for ▁( OfficeVisitBean ▁ov : ▁officeVisits ) ▁{ ▁for ▁( ProcedureBean ▁proc : ▁action . get Complete OfficeVisit ( ov . get VisitID ()). get Procedures ()) ▁{ ▁if ▁( null ▁ != ▁proc . get Attribute () ▁&& ▁proc . get Attribute (). equals (" immunization ")) ▁{ ▁%> ▁< tr > ▁< td ▁><%= proc . getCPTCode () ▁%></ td > ▁< td ▁><%= proc . get Description () ▁%></ td > ▁< td ▁>< a ▁href =" e ditOfficeVisit . jsp ? ovID =<%= ov . get VisitID ()%>"><%= proc . getDate () ▁%></ a ></ td > ▁</ tr > ▁<% ▁} ▁} ▁} ▁%> ▁</ table > ▁</ div > ▁</ div > ▁< br ▁/>< br ▁/>< br ▁/> ▁< itrust : patient Nav ▁thisTitle =" Health ▁Records " ▁/> ▁<%@ include ▁file ="/ f ooter . jsp " ▁%>