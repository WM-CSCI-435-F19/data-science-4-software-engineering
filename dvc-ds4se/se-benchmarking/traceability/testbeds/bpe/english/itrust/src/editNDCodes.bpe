▁<%@ page ▁import =" java . net . URLEncoder " ▁%> ▁<%@ page ▁import =" java . net . URL Decode r " ▁%> ▁<%@ page ▁import =" java . util . List "%> ▁<%@ page ▁import =" edu . nc su . cs c . itrust . beans . MedicationBean "%> ▁<%@ page ▁import =" edu . nc su . cs c . itrust . beans . DrugInteraction Bean "%> ▁<%@ page ▁import =" edu . nc su . cs c . itrust . action . Update NDCodeListAction "%> ▁<%@ page ▁import =" edu . nc su . cs c . itrust . action . DrugInteraction Action "%> ▁<%@ page ▁import =" edu . nc su . cs c . itrust . exception . FormValidat ionException "%> ▁<%@ page ▁import =" edu . nc su . cs c . itrust . exception . iTrustException "%> ▁<%@ include ▁file ="/ global . jsp " ▁%> ▁<% ▁pageTitle ▁= ▁" iTrust ▁- ▁M aintain ▁ND ▁Codes "; ▁%> ▁<%@ include ▁file ="/ header . jsp " ▁%> ▁<% ▁Update NDCodeListAction ▁ndUpdater ▁= ▁new ▁Update NDCodeListAction ( prodDAO , ▁loggedInMID . longValue ()); ▁DrugInteraction Action ▁interaction Action ▁= ▁new ▁DrugInteraction Action ( prodDAO , ▁loggedInMID . longValue ()); ▁String ▁headerMessage ▁= ▁" Viewing ▁Current ▁ND ▁Codes "; ▁String ▁code 1 ▁= ▁request . getParameter (" code 1 ") ▁ != ▁null ▁? ▁request . getParameter (" code 1 "). tr im () ▁: ▁""; ▁String ▁code 2 ▁= ▁request . getParameter (" code 2 ") ▁ != ▁null ▁? ▁request . getParameter (" code 2 "). tr im () ▁: ▁""; ▁String ▁code ▁= ▁code 1 ▁+ ▁code 2 ; ▁if ▁( request . getParameter (" add ") ▁ != ▁null ▁|| ▁request . getParameter (" update ") ▁ != ▁null ▁|| ▁request . getParameter (" delete ") ▁ != ▁null ) ▁{ ▁try ▁{ ▁if ( request . getParameter (" add ") ▁ != ▁null ▁|| ▁request . getParameter (" update ") ▁ != ▁null ) ▁{ ▁MedicationBean ▁med ▁= ▁new ▁MedicationBean ( code , ▁request . getParameter (" description ")); ▁headerMessage ▁= ▁( request . getParameter (" add ") ▁ != ▁null ) ▁? ▁ndUpdater . add NDCode ( med ) ▁: ▁ndUpdater . update Information ( med ); ▁} ▁else ▁{ ▁if ( request . getParameter (" code To Delete ") ▁ != ▁null ) ▁{ ▁interaction Action . delete Interaction ( code , ▁request . getParameter (" code To Delete "). tr im ()); ▁headerMessage ▁= ▁" Interaction ▁delete d ▁successfully "; ▁} ▁else ▁headerMessage ▁= ▁" Interaction ▁does ▁not ▁exist "; ▁} ▁} ▁catch ( FormValidat ionException ▁e ) ▁{ ▁%> ▁< div ▁align = center > ▁< span ▁class =" iTrust Error "><%= e . getMessage () ▁%></ span > ▁</ div > ▁<% ▁headerMessage ▁= ▁" Validation ▁Errors "; ▁} ▁catch ( iTrustException ▁e ) ▁{ ▁%> ▁< div ▁align = center > ▁< span ▁class =" iTrust Error "><%= e . getMessage () ▁%></ span > ▁</ div > ▁<% ▁headerMessage ▁= ▁" Validation ▁Errors "; ▁} ▁} ▁String ▁header Color ▁= ▁( headerMessage . index Of (" Error ") ▁> ▁-1) ▁? ▁"# ffc ccc " ▁: ▁"#00 C CCC "; ▁%> ▁< br ▁/> ▁< div ▁align = center > ▁< form ▁name =" mainForm " ▁method =" post "> ▁< input ▁type =" hidden " ▁id =" code To Delete " ▁name =" code To Delete " ▁value =""> ▁< input ▁type =" hidden " ▁id =" update ID " ▁name =" update ID " ▁value =""> ▁< input ▁type =" hidden " ▁id =" ol dDescrip " ▁name =" ol dDescrip " ▁value =""> ▁< script ▁type =" text / javascript "> ▁function ▁fillUpdate ( code ) ▁{ ▁document . getElementById (" code 1 "). value ▁= ▁code . substring (0, 5 ); ▁document . getElementById (" code 2 "). value ▁= ▁code . substring ( 5 ); ▁document . getElementById (" description "). value ▁= ▁un escape ( document . getElementById (" UPD " ▁+ ▁code ) . value ); ▁document . getElementById (" ol dDescrip "). value ▁= ▁un escape ( document . getElementById (" UPD " ▁+ ▁code ) . value ); ▁document . getElementById (" interactions "). innerH TML ▁= ▁""; ▁document . getElementById (" intDesc "). innerH TML ▁= ▁""; ▁drugs ▁= ▁document . getElementById (" INTDRUG " ▁+ ▁code ) . value . spl it ("\ n "); ▁descs ▁= ▁document . getElementById (" INTDESC " ▁+ ▁code ) . value . spl it ("\ n "); ▁for ( d ▁in ▁drugs ) ▁{ ▁if ( d ▁== ▁drugs . length ▁- ▁1) ▁break ; ▁intLink ▁= ▁document . create Element (" a "); ▁intLink . h ref ▁= ▁" javascript : void (0)" ; ▁intLink . id ▁= ▁" drug Interaction " ▁+ ▁d ; ▁if ( d ▁== ▁0) ▁{ ▁ addIntDesc ( drug s [ d ] , ▁descs [ d ] ); ▁} ▁if ( document . all ) ▁{ ▁intLink . at t ach E v ent (" onclick ", ▁ addIntDesc I E ); ▁// Str ip ▁newline ▁of f ▁end ▁of ▁drug ▁code ▁drugs [ d ] ▁= ▁drugs [ d ] . substring (0, ▁drugs [ d ] . length -1 ); ▁} ▁else ▁{ ▁intLink . set Attribute (" onclick ", ▁" addIntDesc (' " ▁+ ▁drugs [ d ] ▁+ ▁" ' , ▁' " ▁+ ▁descs [ d ] ▁+ ▁" ');" ); ▁} ▁var ▁intText ▁= ▁drugs [ d ] ; ▁if ( document . getElementById (" UPD " ▁+ ▁intText ) . value ▁ != ▁"" ▁&& ▁document . getElementById (" UPD " ▁+ ▁intText ) . value ▁ != ▁" un defined ") ▁{ ▁intText ▁= ▁intText ▁+ ▁" ▁" ▁+ ▁un escape ( document . getElementById (" UPD " ▁+ ▁drugs [ d ] ) . value ); ▁} ▁intText ▁= ▁intText . substring (0, 5 ) ▁+ ▁"-" ▁+ ▁intText . substring ( 5 ); ▁intLink T ext ▁= ▁document . create T ext No de ( int T ext ); ▁intLink . append Child ( int Link T ext ); ▁document . getElementById (" interactions "). append Child ( int Link ); ▁document . getElementById (" interactions "). append Child ( document . create Element (' br ' )); ▁} ▁if ( drug s . length ▁< = ▁1) ▁{ ▁document . getElementById (" interactions "). innerH TML ▁= ▁" No ▁ Interactions "; ▁if ( document . getElementById (" delete "). style ▁ != ▁null ) ▁{ ▁document . getElementById (" delete "). style . visibility ▁= ▁" hidden "; ▁} ▁} ▁} ▁function ▁ addIntDesc I E () ▁{ ▁linkID ▁= ▁event . src Element . id ; ▁linkID ▁= ▁linkID . substring ( 15 ); ▁// Get ▁number ▁after ▁" drug Interaction " ▁ linkNumber ▁= ▁e val ( link ID ); ▁ addIntDesc ( drug s [ linkNumber ] , ▁descs [ linkNumber ] ); ▁} ▁function ▁ addIntDesc ( code , ▁ desc ) ▁{ ▁document . getElementById (" intDesc "). innerH TML ▁= ▁ desc ; ▁document . getElementById (" delete "). style . visibility ▁= ▁""; ▁document . getElementById (" code To Delete "). value ▁= ▁code ; ▁} ▁</ script > ▁< span ▁class =" iTrustMessage "><%= headerMessage ▁%></ span > ▁< br ▁/> ▁< br ▁/> ▁< table ▁class =" f Table " ▁align =" center "> ▁< tr > ▁< th ▁col span ="3"> Update ▁ND ▁Code ▁List </ th > ▁</ tr > ▁< tr ▁class =" subHeader "> ▁< th > Code </ th > ▁< th > Description </ th > ▁</ tr > ▁< tr > ▁< td ▁ style =" padding - right : ▁10 px ;"> ▁< input ▁type =" text " ▁id =" code 1" ▁name =" code 1" ▁size ="5" ▁maxlength ="5" ▁/> - < input ▁type =" text " ▁id =" code 2" ▁name =" code 2" ▁size ="4" ▁maxlength ="4" / > ▁</ td > ▁< td > ▁< input ▁type =" text " ▁id =" description " ▁name =" description " ▁size ="40" ▁maxlength ="50 " ▁/> ▁</ td > ▁</ tr > ▁< tr ▁class =" subHeader "> ▁< th > Interaction </ th > ▁< th > Description </ th > ▁</ tr > ▁< tr > ▁< td ▁ style =" padding - right : ▁10 px ; " ▁id =" interactions "> ▁</ td > ▁< td > ▁< div ▁id =" intDesc "></ div > ▁< div ▁align =" center ">< input ▁type =" submit " ▁value =" Delete ▁Interaction " ▁name =" delete " ▁id =" delete " ▁ style =" visibility : ▁ hidden "/> </ div > ▁</ td > ▁</ tr > ▁</ table > ▁< br ▁/> ▁< input ▁type =" submit " ▁name =" add " ▁value =" Add ▁Code " ▁/> ▁< input ▁type =" submit " ▁name =" update " ▁value =" Update ▁Code " ▁/> ▁< br ▁/> ▁< br ▁/> ▁< table ▁class =" f Table " ▁align =" center "> ▁< tr > ▁< th ▁col span ="2"> Current ▁NDC s </ th > ▁</ tr > ▁< tr ▁class =" subHeader "> ▁< th > Code </ th > ▁< th > Description </ th > ▁</ tr > ▁<% ▁List < MedicationBean > ▁medList ▁= ▁prodDAO . get NDCodesDAO (). getAll NDCodes (); ▁List < DrugInteraction Bean > ▁interaction List ; ▁String ▁tempCode ▁= ▁""; ▁String ▁ tempDescrip ▁= ▁""; ▁String ▁ escapedDescrip ▁= ▁""; ▁String ▁ intDrugsString ▁= ▁""; ▁String ▁ intDescsString ▁= ▁""; ▁for ▁( MedicationBean ▁medEntry ▁: ▁medList ) ▁{ ▁tempCode ▁= ▁medEntry . getNDCode (); ▁ tempDescrip ▁= ▁medEntry . get Description (); ▁ escapedDescrip ▁= ▁ URLEncoder . encode ( tempDescrip , ▁" UTF -8") . replace All (" \\ +", ▁" %20 "); ▁interaction List ▁= ▁interaction Action . get Interactions ( tempCode ); ▁ intDrugsString ▁= ▁""; ▁ intDescsString ▁= ▁""; ▁for ( DrugInteraction Bean ▁b ▁: ▁interaction List ) ▁{ ▁if ( tempCode . equals ( b . get FirstDrug ())) ▁ intDrugsString ▁+= ▁b . get SecondDrug () ▁+ ▁"\ n "; ▁if ( tempCode . equals ( b . get SecondDrug ())) ▁ intDrugsString ▁+= ▁b . get FirstDrug () ▁+ ▁"\ n "; ▁ intDescsString ▁+= ▁b . get Description () ▁+ ▁"\ n "; ▁} ▁// intDrugsString ▁= ▁ URLEncoder . encode ( intDrugsString , ▁" UTF -8") . replace All (" \\ +", ▁" %20 "); ▁// intDescsString ▁= ▁ URLEncoder . encode ( intDescsString , ▁" UTF -8") . replace All (" \\ +", ▁" %20 "); ▁%> ▁< tr > ▁< td ><%= 5 ▁> ▁tempCode . length () ▁? ▁tempCode ▁: ▁tempCode . substring (0, ▁5) ▁%> - <%= 5 ▁> ▁tempCode . length () ▁? ▁"" ▁: ▁tempCode . substring ( 5 ) ▁%> ▁</ td > ▁< td >< a ▁href =" javascript : void (0)" ▁ onclick =" fillUpdate ('<%= tempCode ▁%> ' ) " ▁><%= tempDescrip ▁%></ a > ▁< input ▁type =" hidden " ▁id =" UPD <%= tempCode ▁%>" ▁name =" UPD <%= tempCode ▁%>" ▁value ="<%= escapedDescrip ▁%>"> ▁< input ▁type =" hidden " ▁id =" INTDRUG <%= tempCode ▁%>" ▁name =" INTDRUG <%= tempCode ▁%>" ▁value ="<%= intDrugsString ▁%>"> ▁< input ▁type =" hidden " ▁id =" INTDESC <%= tempCode ▁%>" ▁name =" INTDESC <%= tempCode ▁%>" ▁value ="<%= intDescsString ▁%>"> ▁</ td > ▁</ tr > ▁<% ▁} ▁%> ▁</ table > ▁</ form > ▁< br ▁/> ▁< br ▁/> ▁< a ▁href =" edit NDC Interactions . jsp "> Edit ▁ Interactions </ a > ▁</ div > ▁< br ▁/> ▁<%@ include ▁file ="/ f ooter . jsp " ▁%>