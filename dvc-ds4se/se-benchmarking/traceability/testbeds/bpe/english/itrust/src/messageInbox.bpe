▁<%@ page ▁error Page ="/ auth / exception Handler . jsp "%> ▁<%@ page ▁import =" java . util . List "%> ▁<%@ page ▁import =" edu . nc su . cs c . itrust . action . ViewMyMessages Action "%> ▁<%@ page ▁import =" edu . nc su . cs c . itrust . action . E ditPatientAction "%> ▁<%@ page ▁import =" edu . nc su . cs c . itrust . beans . MessageBean "%> ▁<%@ page ▁import =" edu . nc su . cs c . itrust . dao . DAOFactory "%> ▁<%@ page ▁import =" edu . nc su . cs c . itrust . dao . mysql . PatientDAO "%> ▁<%@ page ▁import =" java . util . ArrayList "%> ▁<%@ page ▁import =" java . text . DateFormat "%> ▁<%@ page ▁import =" java . text . SimpleDateFormat "%> ▁<%@ page ▁import =" java . util . Date "%> ▁<%@ page ▁import =" java . util . Calendar "%> ▁<%@ include ▁file ="/ global . jsp " ▁%> ▁<% ▁pageTitle ▁= ▁" iTrust ▁- ▁View ▁My ▁Message ▁" ; ▁%> ▁<%@ include ▁file ="/ header . jsp " ▁%> ▁< div ▁align = center > ▁< h 2> My ▁Messages </ h 2> ▁<% ▁ViewMyMessages Action ▁action ▁= ▁new ▁ViewMyMessages Action ( prodDAO , ▁loggedInMID . longValue ()); ▁E ditPatientAction ▁f _ action ▁= ▁new ▁E ditPatientAction ( prodDAO , ▁loggedInMID . longValue (), ▁loggedInMID . to String ()); ▁PatientDAO ▁ dao ▁= ▁new ▁PatientDAO ( prodDAO ); ▁List < MessageBean > ▁messages ▁= ▁null ; ▁// Edit ▁Filter ▁back end ▁boolean ▁editing ▁= ▁false ; ▁String ▁headerMessage ▁= ▁""; ▁String [ ] ▁fields ▁= ▁new ▁String [ 6 ] ; ▁if ( request . getParameter (" edit ") ▁ != ▁null ▁&& ▁request . getParameter (" edit "). equals (" true ")) ▁{ ▁editing ▁= ▁true ; ▁int ▁i ; ▁for ( i =0; ▁i < 6 ; ▁i ++) ▁{ ▁fields [ i ] ▁= ▁""; ▁} ▁if ( request . getParameter (" cancel ") ▁ != ▁null ) ▁response . send Redirect (" message Inbox . jsp "); ▁else ▁if ( request . getParameter (" test ") ▁ != ▁null ▁|| ▁request . getParameter (" save ") ▁ != ▁null ) ▁{ ▁boolean ▁error ▁= ▁false ; ▁String ▁nf ▁= ▁""; ▁nf ▁+= ▁request . getParameter (" sender "). replace (",", "")+" , "; ▁nf ▁+= ▁request . getParameter (" subject "). replace (",", "")+" , "; ▁nf ▁+= ▁request . getParameter (" has W ords "). replace (",", "")+" , "; ▁nf ▁+= ▁request . getParameter (" not W ords "). replace (",", "")+" , "; ▁nf ▁+= ▁request . getParameter (" startDate "). replace (",", "")+" , "; ▁nf ▁+= ▁request . getParameter (" endDate "); ▁// V a li date ▁Filter ▁nf ▁= ▁action . validate And Create Filter ( nf ); ▁if ( nf . start sWith (" Error ")) ▁{ ▁error ▁= ▁true ; ▁headerMessage ▁= ▁nf ; ▁} ▁if (! error ) ▁{ ▁if ( request . getParameter (" test ") ▁ != ▁null ) ▁{ ▁response . send Redirect (" message Inbox . jsp ? edit = true & testFilter ="+ nf ); ▁} ▁else ▁if ( request . getParameter (" save ") ▁ != ▁null ) ▁{ ▁f _ action . edit MessageFilter ( nf ); ▁response . send Redirect (" message Inbox . jsp ? filter = true "); ▁} ▁} ▁} ▁if ( request . getParameter (" testFilter ") ▁ != ▁null ) ▁{ ▁String ▁filter ▁= ▁request . getParameter (" testFilter "); ▁String [ ] ▁f ▁= ▁filter . spl it (",", ▁-1) ; ▁for ( i =0; ▁i < 6 ; ▁i ++) ▁{ ▁try ▁{ ▁fields [ i ] ▁= ▁f [ i ] ; ▁} ▁catch ( Array Index Out OfB ounds Exception ▁e ) ▁{ ▁// do ▁nothing ▁} ▁} ▁} ▁else ▁{ ▁String ▁filter ▁= ▁ dao . getPatient ( loggedInMID . longValue ()). get MessageFilter (); ▁if (! filter . equals ("")) ▁{ ▁String [ ] ▁f ▁= ▁filter . spl it (",", ▁-1) ; ▁for ( i =0; ▁i < 6 ; ▁i ++) ▁{ ▁try ▁{ ▁fields [ i ] ▁= ▁f [ i ] ; ▁} ▁catch ( Array Index Out OfB ounds Exception ▁e ) ▁{ ▁// do ▁nothing ▁} ▁} ▁} ▁} ▁} ▁// Sort s ▁messages ▁if ( request . getParameter (" sort ") ▁ != ▁null ) ▁{ ▁if ( request . getParameter (" sort by "). equals (" name ")) ▁{ ▁if ( request . getParameter (" sort how "). equals (" asce ")) ▁{ ▁messages ▁= ▁action . getAllMyMessages Name Ascending (); ▁} ▁else ▁{ ▁messages ▁= ▁action . getAllMyMessages Name Descending (); ▁} ▁} ▁else ▁if ( request . getParameter (" sort by "). equals (" time ")) ▁{ ▁if ( request . getParameter (" sort how "). equals (" asce ")) ▁{ ▁messages ▁= ▁action . getAllMyMessages Time Ascending (); ▁} ▁else ▁{ ▁messages ▁= ▁action . getAllMyMessages (); ▁} ▁} ▁} ▁else ▁{ ▁messages ▁= ▁action . getAllMyMessages (); ▁} ▁// Filter s ▁Messages ▁boolean ▁is _ filtered ▁= ▁false ; ▁if ( ( request . getParameter (" filter ") ▁ != ▁null ▁&& ▁request . getParameter (" filter "). equals (" true ")) ▁|| ▁request . getParameter (" testFilter ") ▁ != ▁null ) ▁{ ▁String ▁filter ▁= ▁""; ▁if ( request . getParameter (" testFilter ") ▁ != ▁null ) ▁{ ▁filter ▁= ▁request . getParameter (" testFilter "); ▁} ▁else ▁{ ▁filter ▁= ▁ dao . getPatient ( loggedInMID . longValue ()). get MessageFilter (); ▁} ▁if (! filter . equals ("") ▁&& ▁! filter . equals (" , , , , , ")) ▁{ ▁List < MessageBean > ▁filtered ▁= ▁action . filter Messages ( messages , ▁filter ); ▁messages ▁= ▁filtered ; ▁is _ filtered ▁= ▁true ; ▁} ▁} ▁session . set Attribute (" messages ", ▁messages ); ▁%> ▁<% ▁if ( edit ing ) ▁{ ▁%> ▁< div ▁class =" filter Edit "> ▁< div ▁align =" center "> ▁< span ▁ style =" font - size : ▁13 pt ; ▁ font - weight : ▁bold ;"> Edit ▁Message ▁Filter </ span > ▁<%= ▁headerMessage . equals ("") ▁? ▁"" ▁: ▁"< br ▁/>< span ▁class =\" iTrustMessage \">"+ headerMessage +"</ span >< br ▁/>< br ▁/> " ▁%> ▁< form ▁method =" post " ▁action =" message Inbox . jsp ? edit = true "> ▁< table > ▁< tr ▁ style =" text - align : ▁right ;"> ▁< td > ▁< label ▁for =" sender "> Sender : ▁</ label > ▁< input ▁type =" text " ▁name =" sender " ▁id =" sender " ▁value ="<%= fields [0 ] ▁%>" ▁/> ▁</ td > ▁< td ▁ style =" padding - left : ▁10 px ; ▁padding - right : ▁10 px ;"> ▁< label ▁for =" has W ords "> Ha s ▁the ▁words : ▁</ label > ▁< input ▁type =" text " ▁name =" has W ords " ▁id =" has W ords " ▁value ="<%= fields [2 ] ▁%>" ▁/> ▁</ td > ▁< td > ▁< label ▁for =" startDate "> Start ▁Date : ▁</ label > ▁< input ▁type =" text " ▁name =" startDate " ▁id =" startDate " ▁value ="<%= fields [4 ] ▁%>" ▁/> ▁< input ▁type =" button " ▁value =" Select ▁Date " ▁ onclick =" display DatePicker (' startDate ');" ▁/> ▁</ td > ▁</ tr > ▁< tr ▁ style =" text - align : ▁right ;"> ▁< td > ▁< label ▁for =" subject "> Subject : ▁</ label > ▁< input ▁type =" text " ▁name =" subject " ▁id =" subject " ▁value ="<%= fields [1 ] ▁%>" ▁/> ▁</ td > ▁< td ▁ style =" padding - left : ▁10 px ; ▁padding - right : ▁10 px ;"> ▁< label ▁for =" not W ords "> D oe s ▁not ▁have ▁the ▁words : ▁</ label > ▁< input ▁type =" text " ▁name =" not W ords " ▁id =" not W ords " ▁value ="<%= fields [3 ] ▁%>" ▁/> ▁</ td > ▁< td > ▁< label ▁for =" endDate "> End ▁Date : ▁</ label > ▁< input ▁type =" text " ▁name =" endDate " ▁id =" endDate " ▁value ="<%= fields [5 ] ▁%>" ▁/> ▁< input ▁type =" button " ▁value =" Select ▁Date " ▁ onclick =" display DatePicker (' endDate ');" ▁/> ▁</ td > ▁</ tr > ▁< tr ▁ style =" text - align : ▁center ;"> ▁< td ▁col span ="3"> ▁< input ▁type =" submit " ▁name =" test " ▁value =" Test ▁Filter " ▁/> ▁< input ▁type =" submit " ▁name =" save " ▁value =" Save " ▁/> ▁< input ▁type =" submit " ▁name =" cancel " ▁value =" Cancel " ▁/> ▁</ td > ▁</ tr > ▁</ table > ▁</ form > ▁</ div > ▁</ div > ▁< br ▁/> ▁<% ▁} ▁%> ▁< form ▁method =" post " ▁action =" message Inbox . jsp <%= is _ filtered ?" ? filter = true ":"" ▁%>"> ▁< table > ▁< tr > ▁< td > ▁< select ▁name =" sort by "> ▁< option ▁value =" time "> Sort </ option > ▁< option ▁value =" name "> Name </ option > ▁< option ▁value =" time "> Time </ option > ▁</ select > ▁</ td > ▁< td > ▁< select ▁name =" sort how "> ▁< option ▁value =" desc "> O rder </ option > ▁< option ▁value =" asce "> Ascending </ option > ▁< option ▁value =" desc "> Descending </ option > ▁</ select > ▁</ td > ▁< td > ▁< input ▁type =" submit " ▁name =" sort " ▁value =" Sort " ▁/> ▁</ td > ▁</ tr > ▁< tr > ▁< td >< a ▁href =" message Inbox . jsp ? edit = true " ▁> Edit ▁Filter </ a ></ td > ▁< td >< a ▁href =" message Inbox . jsp ? filter = true " ▁> App ly ▁Filter </ a ></ td > ▁</ tr > ▁</ table > ▁</ form > ▁< br ▁/> ▁<% if ( messages . size () ▁> ▁0) ▁{ ▁%> ▁< table ▁class =" fancyTable "> ▁< tr > ▁< th > Sender </ th > ▁< th > Subject </ th > ▁< th > Received </ th > ▁< th ></ th > ▁</ tr > ▁<% ▁int ▁index ▁= ▁0; ▁for ( MessageBean ▁message ▁: ▁messages ) ▁{ ▁if ( message . get Read () ▁== ▁0) ▁{%> ▁< tr ▁ style =" font - weight : ▁bold ; " ▁<%=( index %2 ▁== ▁1 )?" class =\" alt \"":"" ▁%> > ▁< td ><%= ▁action . getName ( message . get From ()) ▁%></ td > ▁< td ><%= ▁message . get Subject () ▁%></ td > ▁< td ><%= ▁message . getSen tDate () ▁%></ td > ▁< td >< a ▁href =" viewMessage Inbox . jsp ? msg =<%= ▁index ▁%>"> Read </ a ></ td > ▁</ tr > ▁<% ▁} ▁else ▁{ ▁%> ▁< tr ▁<%=( index %2 ▁== ▁1 )?" class =\" alt \"":"" ▁%> > ▁< td ><%= ▁action . getName ( message . get From ()) ▁%></ td > ▁< td ><%= ▁message . get Subject () ▁%></ td > ▁< td ><%= ▁message . getSen tDate () ▁%></ td > ▁< td >< a ▁href =" viewMessage Inbox . jsp ? msg =<%= ▁index ▁%>"> Read </ a ></ td > ▁</ tr > ▁<% ▁} ▁%> ▁<% ▁index ▁++; ▁%> ▁<% ▁} ▁%> ▁</ table > ▁<% ▁} ▁else ▁{ ▁%> ▁< div > ▁< i > You ▁have ▁no ▁messages </ i > ▁</ div > ▁<% ▁} ▁%> ▁< br ▁/> ▁</ div > ▁<%@ include ▁file ="/ f ooter . jsp " ▁%>