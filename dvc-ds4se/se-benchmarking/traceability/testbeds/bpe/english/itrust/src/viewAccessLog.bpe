▁<%@ page ▁import =" edu . nc su . cs c . itrust . action . ViewMy AccessLogAction "%> ▁<%@ page ▁import =" java . util . List "%> ▁<%@ page ▁import =" edu . nc su . cs c . itrust . beans . TransactionBean "%> ▁<%@ page ▁import =" edu . nc su . cs c . itrust . exception . FormValidat ionException "%> ▁<%@ page ▁import =" edu . nc su . cs c . itrust . beans . PersonnelBean "%> ▁<%@ page ▁import =" edu . nc su . cs c . itrust . dao . mysql . PersonnelDAO "%> ▁<%@ page ▁import =" edu . nc su . cs c . itrust . beans . PatientBean "%> ▁<%@ page ▁import =" edu . nc su . cs c . itrust . dao . mysql . PatientDAO "%> ▁<%@ page ▁error Page ="/ auth / exception Handler . jsp " ▁%> ▁<%@ page ▁import =" java . util . ArrayList "%> ▁<%@ include ▁file ="/ global . jsp "%> ▁<% ▁pageTitle ▁= ▁" iTrust ▁- ▁View ▁My ▁Access ▁Log "; ▁%> ▁<%@ include ▁file ="/ header . jsp "%> ▁<% ▁session . remove Attribute (" personnelList "); ▁ViewMy AccessLogAction ▁action ▁= ▁new ▁ViewMy AccessLogAction ( DAOFactory . getPr oductionInstance (), ▁loggedInMID ); ▁List < TransactionBean > ▁accesses ; ▁try { ▁accesses ▁= ▁action . get Accesse s ( request . getParameter (" startDate "), ▁request . getParameter (" endDate "), ▁" role " . equals ( request . getParameter (" sortBy ")) ); ▁} ▁catch ( FormValidat ionException ▁e ){ ▁e . print HTML ( pageContext . get Out ()); ▁accesses ▁= ▁action . get Accesse s ( null , null , false ); ▁} ▁%> ▁< br ▁/> ▁< table ▁class =" f Table " ▁align =' center '> ▁< tr > ▁< th >< a ▁href ="# " ▁on Click =" javascript : sortBy (' date ');"> Date </ a ></ th > ▁< th > Access or </ th > ▁< th >< a ▁href ▁= ▁"# " ▁on Click =" javascript : sortBy (' role ');"> Role </ a ></ th > ▁< th > Description </ th > ▁</ tr > ▁<% ▁boolean ▁has Data ▁= ▁false ; ▁List < PersonnelBean > ▁personnelList ▁= ▁new ▁ArrayList < PersonnelBean > (); ▁int ▁index ▁= ▁0; ▁for ( TransactionBean ▁t ▁: ▁accesses ){ ▁PersonnelBean ▁hcp ▁= ▁new ▁PersonnelDAO ( DAOFactory . getPr oductionInstance ()). getPersonnel ( t . get LoggedInMID ()); ▁if ▁( hcp ▁ != ▁null ) ▁{ ▁has Data ▁= ▁true ; ▁%> ▁< tr > ▁< td ▁><%= t . get TimeLogged ()%></ td > ▁< td ▁>< a ▁href ="/ iTrust / auth / view Personnel . jsp ? personnel =<%= index %>"><%= hcp . getF ullName ()%></ a ></ td > ▁< td ><%= t . getRole () ▁%></ td > ▁< td ▁><%= t . getA ddedInfo ()%> ▁(<%= t . get TransactionType (). get Code ()%>)</ td > ▁</ tr > ▁<% ▁PersonnelBean ▁personnel ▁= ▁new ▁PersonnelDAO ( prodDAO ) . getPersonnel ( t . get LoggedInMID ()); ▁personnelList . add ( personnel ); ▁index ++; ▁} ▁else ▁if (" Person al ▁Health ▁ Representative " . equals ( t . getRole ())) ▁{ ▁PatientBean ▁p ▁= ▁new ▁PatientDAO ( DAOFactory . getPr oductionInstance ()). getPatient ( t . get LoggedInMID ()); ▁%> ▁< tr > ▁< td ▁><%= t . get TimeLogged ()%></ td > ▁< td ▁><%= p . getF ullName ()%></ td > ▁< td ><%= t . getRole ()%></ td > ▁< td ▁><%= t . getA ddedInfo ()%> ▁(<%= t . get TransactionType (). get Code ()%>)</ td > ▁</ tr > ▁<% ▁} ▁} ▁session . set Attribute (" personnelList ", ▁personnelList ); ▁if (! has Data ) ▁{ ▁%> ▁< tr > ▁< td ▁col span = 3 ▁align =" center "> No ▁Data </ td > ▁</ tr > ▁<% ▁} ▁String ▁startDate ▁= ▁action . get Default Start ( accesses ); ▁String ▁endDate ▁= ▁action . get Default End ( accesses ); ▁if (" role " . equals ( request . getParameter (" sortBy "))) ▁{ ▁startDate ▁= ▁request . getParameter (" startDate "); ▁endDate ▁= ▁request . getParameter (" endDate "); ▁} ▁%> ▁</ table > ▁< br ▁/> ▁< br ▁/> ▁< form ▁action =" view AccessLog . jsp " ▁method =" post "> ▁< input ▁type =" hidden " ▁name =" sortBy " ▁value =" "></ input > ▁< div ▁align = center > ▁< table ▁class =" f Table " ▁align =" center "> ▁< tr ▁class =" subHeader "> ▁< td > Start ▁Date :</ td > ▁< td > ▁< input ▁name =" startDate " ▁value ="<%= startDate %>" ▁size ="10"> ▁< input ▁type = button ▁value =" Select ▁Date " ▁ onclick =" display DatePicker (' startDate ');"> ▁</ td > ▁< td > End ▁Date :</ td > ▁< td > ▁< input ▁name =" endDate " ▁value ="<%= endDate %>"> ▁< input ▁type = button ▁value =" Select ▁Date " ▁ onclick =" display DatePicker (' endDate ');"> ▁</ td > ▁</ tr > ▁</ table > ▁< br ▁/> ▁< input ▁type =" submit " ▁name =" submit " ▁value =" Filter ▁Records "> ▁</ div > ▁</ form > ▁< script ▁type =' text / javascript '> ▁function ▁ sortBy ( date O r Role ) ▁{ ▁document . getElement sBy Name (' sortBy ')[ 0 ] . value ▁= ▁date O r Role ; ▁document . forms [0 ] . submit . click (); ▁} ▁</ script > ▁<%@ include ▁file ="/ f ooter . jsp "%>