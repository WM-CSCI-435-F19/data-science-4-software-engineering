▁<%@ page ▁error Page ="/ auth / exception Handler . jsp "%> ▁<%@ page ▁import =" java . util . List "%> ▁<%@ page ▁import =" java . util . Date "%> ▁<%@ page ▁import =" java . sql . Timestamp "%> ▁<%@ page ▁import =" java . text . DateFormat "%> ▁<%@ page ▁import =" java . text . SimpleDateFormat "%> ▁<%@ page ▁import =" edu . nc su . cs c . itrust . beans . ApptBean "%> ▁<%@ page ▁import =" edu . nc su . cs c . itrust . beans . ApptTypeBean "%> ▁<%@ page ▁import =" edu . nc su . cs c . itrust . action . Add Appt Action "%> ▁<%@ page ▁import =" edu . nc su . cs c . itrust . action . Edit ApptTypeAction "%> ▁<%@ page ▁import =" edu . nc su . cs c . itrust . dao . mysql . PatientDAO "%> ▁<%@ page ▁import =" edu . nc su . cs c . itrust . exception . iTrustException "%> ▁<%@ page ▁import =" edu . nc su . cs c . itrust . exception . FormValidat ionException "%> ▁<%@ include ▁file ="/ global . jsp " ▁%> ▁<% ▁pageTitle ▁= ▁" iTrust ▁- ▁ Schedule ▁an ▁Appointment "; ▁String ▁headerMessage ▁= ▁" P lease ▁fill ▁out ▁the ▁form ▁properly ▁- ▁comment s ▁are ▁optional . "; ▁%> ▁<%@ include ▁file ="/ header . jsp " ▁%> ▁<% ▁AddApptAction ▁action ▁= ▁new ▁AddApptAction ( prodDAO , ▁loggedInMID . longValue ()); ▁Edit ApptTypeAction ▁types ▁= ▁new ▁Edit ApptTypeAction ( prodDAO , ▁loggedInMID . longValue ()); ▁PatientDAO ▁patientDAO ▁= ▁prodDAO . get PatientDAO (); ▁long ▁patientID ▁= ▁0 L ; ▁if ▁( session . get Attribute (" pid ") ▁ != ▁null ) ▁{ ▁String ▁pidString ▁= ▁( String ) ▁session . get Attribute (" pid "); ▁patientID ▁= ▁Long . parse Long ( pidString ); ▁try ▁{ ▁action . getName ( patientID ); ▁} ▁catch ▁( iTrustException ▁it e ) ▁{ ▁patientID ▁= ▁0 L ; ▁session . remove Attribute (" pid "); ▁} ▁} ▁else ▁{ ▁session . remove Attribute (" pid "); ▁} ▁if ▁( patientID ▁== ▁0 L ) ▁{ ▁response . send Redirect ("/ iTrust / auth / getPatientID . jsp ? forward = hcp / scheduleAppt . jsp "); ▁} ▁else ▁{ ▁if ▁( request . getParameter (" sc h edu le ") ▁ != ▁null ) ▁{ ▁if (! request . getParameter (" schedDate "). equals ("")) ▁{ ▁ApptBean ▁appt ▁= ▁new ▁ApptBean (); ▁DateFormat ▁format ▁= ▁new ▁ SimpleDateFormat (" MM / dd / yyyy ▁ hh : mm ▁a "); ▁Date ▁date ▁= ▁format . parse ( request . getParameter (" schedDate " )+" ▁"+ request . getParameter (" time 1" )+" : "+ request . getParameter (" time 2" )+" ▁"+ request . getParameter (" time 3 ")); ▁appt . setHcp ( loggedInMID ); ▁appt . set Patient ( patientID ); ▁appt . set ApptType ( request . getParameter (" apptType ")); ▁appt . setDate ( new ▁Timestamp ( date . getTime ()) ); ▁String ▁comment ▁= ▁""; ▁if ( request . getParameter (" comment "). equals ("")) ▁comment ▁= ▁null ; ▁else ▁comment ▁= ▁request . getParameter (" comment "); ▁appt . set Comment ( comment ); ▁try ▁{ ▁headerMessage ▁= ▁action . add Appt ( appt ); ▁if ( headerMessage . start sWith (" Success ")) ▁{ ▁session . remove Attribute (" pid "); ▁response . send Redirect (" home . jsp "); ▁} ▁} ▁catch ▁( FormValidat ionException ▁e ){ ▁%> ▁< div ▁align = center >< span ▁class =" iTrust Error "><%= e . getMessage ()%></ span ></ div > ▁<% ▁} ▁} ▁else ▁headerMessage ▁= ▁" P lease ▁input ▁a ▁date ▁for ▁the ▁appointment . "; ▁} ▁List < ApptTypeBean > ▁apptType s ▁= ▁types . getApptType s (); ▁%> ▁< div ▁align =" left "> ▁< h 2> Schedule ▁an ▁Appointment </ h 2> ▁< h 4> with ▁<%= ▁action . getName ( patientID ) ▁%> ▁( < a ▁href ="/ iTrust / auth / getPatientID . jsp ? forward = hcp / scheduleAppt . jsp "> some one ▁else </ a > ) :</ h 4> ▁< span ▁class =" iTrustMessage "><%= headerMessage ▁%></ span >< br ▁/>< br ▁/> ▁< form ▁id =" mainForm " ▁method =" post " ▁action =" scheduleAppt . jsp "> ▁< span > Appointment ▁Type : ▁</ span > ▁< select ▁name =" apptType "> ▁<% ▁for ( ApptTypeBean ▁b ▁: ▁apptType s ) ▁{ ▁%> ▁< option ▁value ="<%= ▁b . getName () ▁%>"><%= ▁b . getName () ▁%> ▁- ▁<%= ▁b . getDuration () ▁%> ▁minutes </ option > ▁<% ▁} ▁%> ▁</ select > ▁< br ▁/>< br ▁/> ▁< span > Schedule ▁Date : ▁</ span >< input ▁readonly ▁type =" text " ▁name =" schedDate " ▁value =" " ▁/>< input ▁type =" button " ▁value =" Select ▁Date " ▁ onclick =" display DatePicker (' schedDate ');" ▁/>< br ▁/>< br ▁/> ▁< span > Schedule ▁ Time : ▁</ span > ▁< select ▁name =" time 1 "> ▁<% ▁String ▁ hour ▁= ▁""; ▁for ( int ▁i ▁= ▁1; ▁i ▁< = ▁12; ▁i ++) ▁{ ▁if ( i ▁< ▁10 ) ▁ hour ▁= ▁"0"+ i ; ▁else ▁ hour ▁= ▁i +" "; ▁%> ▁< option ▁value ="<%= hour %>"><%= hour %></ option > ▁<% ▁} ▁%> ▁</ select > :< select ▁name =" time 2 "> ▁<% ▁String ▁min ▁= ▁""; ▁for ( int ▁i ▁= ▁0; ▁i ▁< ▁60 ; ▁i += 5 ) ▁{ ▁if ( i ▁< ▁10 ) ▁min ▁= ▁"0"+ i ; ▁else ▁min ▁= ▁i +" "; ▁%> ▁< option ▁value ="<%= min %>"><%= min %></ option > ▁<% ▁} ▁%> ▁</ select > ▁< select ▁name =" time 3 ">< option ▁value =" AM "> AM </ option >< option ▁value =" PM "> PM </ option ></ select >< br ▁/>< br ▁/> ▁< span > Comment : ▁</ span >< br ▁/> ▁< textarea ▁name =" comment " ▁cols ="100 " ▁rows ="10"> </ textarea >< br ▁/> ▁< br ▁/> ▁< input ▁type =" submit " ▁value =" Schedule " ▁name =" sc h edu le "/> ▁</ form > ▁< br ▁/> ▁< br ▁/> ▁</ div > ▁<% ▁} ▁%> ▁<%@ include ▁file ="/ f ooter . jsp " ▁%>