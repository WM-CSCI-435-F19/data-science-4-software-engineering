▁<%@ page ▁import =" edu . nc su . cs c . itrust . DBUtil "%> ▁<% ▁if (! DBUtil . ca n Obtain Pr oductionInstance ()){ ▁response . send Error ( Ht t p S ervlet Re sp on se . S C _ SE RV ICE _ UN AVAILABLE ); ▁} ▁if ( request . getUser Prin cipa l () ▁ != ▁null ) ▁{ ▁long ▁mid ▁= ▁Long . value Of ( request . getUser Prin cipa l (). getName ()); ▁ userName ▁= ▁authDAO . getUserName ( mid ); ▁} ▁else ▁{ ▁if ▁( null ▁ != ▁userRole ) ▁{ ▁userRole ▁= ▁null ; ▁response . send Redirect ("/ iTrust / errors / re b o o t . jsp "); ▁} ▁} ▁if ▁( request . get Auth Type () ▁ != ▁null ) ▁{ ▁if ▁( request . getSession ( false ) ▁ != ▁null ) ▁{ ▁boolean ▁ isValid Login ▁= ▁login Failure Action . isValid For Login (); ▁if (! isValid Login ) ▁{ ▁session . invalidate (); ▁return ; ▁} ▁else ▁{ ▁loggedInMID ▁= ▁new ▁Long ( Long . value Of ( request . getUser Prin cipa l (). getName ()) ); ▁session . set Attribute (" loggedInMID ", ▁loggedInMID ); ▁} ▁} ▁} ▁%>