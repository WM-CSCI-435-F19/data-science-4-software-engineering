▁<%@ ▁page ▁import =" java . sql . *, ▁edu . nc su . cs c . itrust . *, ▁edu . nc su . cs c . itrust . user s . *, ▁edu . nc su . cs c . itrust . beans .* " ▁%> ▁<%@ ▁page ▁import =" java . util . *, ▁ com . low a g ie . text . html . HtmlEncoder " ▁%> ▁< ! DOC TYPE ▁ HTML ▁ PUB LIC ▁" - / / W 3 C / / D T D ▁ HTML ▁4 . 0 1 ▁Trans itional / / E N "> ▁< html > ▁< head > ▁< title > iTrust ▁- ▁Visit ▁T r end s </ title > ▁<%@ ▁include ▁file ="/ resources / head . jsp " ▁%> ▁</ head > ▁< body > ▁<% ▁Calendar ▁today = Calendar . get Instance (); ▁int ▁ curMonth = today . get ( Calendar . MONTH ); ▁int ▁ curYear = today . get ( Calendar . YEAR ); ▁String ▁ startMonth ▁= ▁request . getParameter (" startMonth "); ▁String ▁ startYear ▁= ▁request . getParameter (" startYear "); ▁String ▁ endMonth ▁= ▁request . getParameter (" endMonth "); ▁String ▁ endYear ▁= ▁request . getParameter (" endYear "); ▁boolean ▁is Pos t Back ▁= ▁request . getParameter (" action ") ▁ != ▁null ; ▁String ▁Date End Str ▁= ▁ endYear +"-"+ endMonth ; ▁String ▁Date Start Str ▁= ▁ startYear +"-"+ startMonth ; ▁String ▁ firstVisit = Records . get E ar li est Visit (); ▁if ( ( null ▁== ▁ firstVisit ) ▁|| ▁ (" " . equals ( firstVisit ))) ▁{ ▁out . print ln ("< br ▁/>< br ▁/> "); ▁out . print ln ("< h 3 ▁ style =\" text - align : ▁center ; \ "> T here ▁A re ▁ NO ▁Visits ▁Regist er ed </ h 3> "); ▁out . print ln ("< br ▁/>< br ▁/> "); ▁} ▁else ▁{ ▁String ▁firstMonth = firstVisit . substring (5, 7 ); ▁String ▁ firstYear = firstVisit . substring (0, 4 ); ▁String [ ] ▁months = { " January ", ▁" February ", ▁" March ", ▁" April ", ▁" May ", ▁" June ", ▁" July ", ▁" August ", ▁" September ", ▁" October ", ▁" November ", ▁" December " }; ▁%> ▁< form ▁method =" post " ▁id =" form Main "> ▁< script ▁type =" text / javascript " ▁src =" Resource s / Script s / DatePicker . js "></ script > ▁< table ▁align =" center "> ▁< tr > ▁< th ▁col span ="2" ▁ style =" back g round - color : ▁S i l ver ;"> ▁Visit ▁T r end s ▁</ th > ▁</ tr > ▁< tr > ▁< td ▁col span ="2" ▁ style =" text - align : ▁center ; ▁border : ▁solid ▁1 px ▁S i l ver ;"> ▁Select ▁a ▁start ing ▁and ▁ ending ▁month ▁and ▁click ▁Generate Report . ▁</ td > ▁</ tr > ▁< tr ▁ style =" back g round - color :# ffc ccc "> ▁< td ▁ style =" text - align : ▁right ;"> ▁Start ing ▁Month : ▁</ td > ▁< td > ▁< select ▁name =" startMonth "> ▁<% ▁out . print ln ("< option ▁value ="+ first Month +">"+ months [ Integer . parse Int ( first Month ) -1 ] +"</ option >"); ▁%> ▁< option ▁value =" 0 1 "> January </ option > ▁< option ▁value =" 02 "> February </ option > ▁< option ▁value =" 0 3 "> March </ option > ▁< option ▁value =" 0 4 "> April </ option > ▁< option ▁value =" 0 5 "> May </ option > ▁< option ▁value =" 0 6 "> June </ option > ▁< option ▁value =" 07 "> July </ option > ▁< option ▁value =" 0 8 "> August </ option > ▁< option ▁value =" 09 "> September </ option > ▁< option ▁value ="10"> October </ option > ▁< option ▁value ="11"> November </ option > ▁< option ▁value =" 12 "> December </ option > ▁</ select >< br ▁/> ▁< select ▁name =" startYear "> ▁<% ▁out . print ln ("< option ▁value ="+ firstYear +">"+ firstYear +"</ option >"); ▁%> ▁<% ▁for ▁( int ▁ cnt = curYear ; cnt +1 > Integer . parse Int ( firstYear ); cnt -- ) ▁out . print ln ("< option ▁value ="+ cnt +">"+ cnt +"</ option >"); ▁%> ▁</ select > ▁</ td > ▁< tr ▁ style =" back g round - color :# ffc ccc "> ▁< td ▁ style =" text - align : ▁right ;"> ▁End ing ▁Month : ▁</ td > ▁< td > ▁< select ▁name =" endMonth "> ▁<% ▁out . print ln ("< option ▁value ="+ ( curMonth +1 ) +">"+ months [ curMonth ] +"</ option >"); ▁%> ▁< option ▁value =" 0 1 "> January </ option > ▁< option ▁value =" 02 "> February </ option > ▁< option ▁value =" 0 3 "> March </ option > ▁< option ▁value =" 0 4 "> April </ option > ▁< option ▁value =" 0 5 "> May </ option > ▁< option ▁value =" 0 6 "> June </ option > ▁< option ▁value =" 07 "> July </ option > ▁< option ▁value =" 0 8 "> August </ option > ▁< option ▁value =" 09 "> September </ option > ▁< option ▁value ="10"> October </ option > ▁< option ▁value ="11"> November </ option > ▁< option ▁value =" 12 "> December </ option > ▁</ select >< br ▁/> ▁< select ▁name =" endYear "> ▁<% ▁out . print ln ("< option ▁value ="+ curYear +">"+ curYear +"</ option >"); ▁%> ▁<% ▁for ▁( int ▁ cnt = curYear -1 ; cnt +1 > Integer . parse Int ( firstYear ); cnt -- ) ▁out . print ln ("< option ▁value ="+ cnt +">"+ cnt +"</ option >"); ▁%> ▁</ select > ▁</ td > ▁< tr > ▁< td ▁align = center ▁col span =2> ▁< input ▁type =" submit " ▁name =" action " ▁value =" Generate ▁Report "> ▁</ td > ▁</ tr > ▁</ table > ▁<% ▁if ▁( startMonth != null ▁&& ▁ startYear != null ▁&& ▁ endMonth != null ▁&& ▁ endYear != null ) ▁{ ▁if ▁( Integer . parse Int ( startYear ) > Integer . parse Int ( endYear ) ▁|| ▁( Integer . parse Int ( startYear ) == Integer . parse Int ( endYear ) ▁&& ▁Integer . parse Int ( startMonth ) > Integer . parse Int ( endMonth ) )){ ▁%>< table ▁align =" center " ▁ style =" back g round - color : ▁# ffee ee ; ▁border : ▁1 px ▁solid ▁# ff 6666; "> ▁< tr >< td ▁align = center >< b > An ▁Error ▁has ▁occured :</ b >< br ▁/>< br ▁/> Start ▁date ▁is ▁after ▁End ▁Date . </ td ></ tr > ▁</ table >< br ▁/><% ▁} ▁else ▁if ▁( Integer . parse Int ( endYear ) > curYear ▁|| ▁( Integer . parse Int ( endYear ) == curYear ▁&& ▁Integer . parse Int ( endMonth ) > curMonth +1 )){ ▁%>< table ▁align =" center " ▁ style =" back g round - color : ▁# ffee ee ; ▁border : ▁1 px ▁solid ▁# ff 6666; "> ▁< tr >< td ▁align = center >< b > An ▁Error ▁has ▁occured :</ b >< br ▁/>< br ▁/> End ▁date ▁is ▁in ▁the ▁future . </ td ></ tr > ▁</ table >< br ▁/><% ▁} ▁else ▁{ ▁if ▁( startMonth . length () < 2) ▁ startMonth ="0" + startMonth ; ▁if ▁( endMonth . length () < 2) ▁ endMonth ="0" + endMonth ; ▁Visit Report ▁vr = null ; ▁try ▁{ ▁vr = new ▁Visit Report ( startYear +"-"+ startMonth , ▁ endYear +"-"+ endMonth ); ▁vr . com put e Visit s (); ▁} ▁catch ▁( User Data Exception ▁e ) ▁{ ▁out . print ln ("< table ▁align = center ▁b g color = r ed >< tr >< td >< font ▁color = white >"); ▁out . print ln ("< b > An ▁Error ▁has ▁O c cur ed </ b > : ▁< br ▁/> "); ▁out . print ln ( e . get Error Message ()); ▁out . print ln (" </ font ></ td ></ tr ></ table >"); ▁} ▁ Vector < Integer > ▁minors = vr . get Min or s (); ▁ Vector < Integer > ▁adults = vr . getA d ul t s (); ▁int ▁mostVisits ; ▁int ▁leastVisits ; ▁if ▁( minors . element At (0) ▁< ▁adults . element At (0) ) ▁{ ▁mostVisits = ad ul t s . element At (0); ▁leastVisits = minors . element At (0); ▁} ▁else ▁{ ▁mostVisits = minors . element At (0); ▁leastVisits = ad ul t s . element At (0); ▁} ▁int ▁ NUM _ DAYS = vr . getNum Month s (); ▁for ▁( ▁int ▁i ▁= ▁1; ▁i ▁< ▁ NUM _ DAYS ; ▁i ++ ▁ ) ▁{ ▁if ▁( ▁minors . element At ( i ) ▁> ▁mostVisits ▁ ) ▁mostVisits ▁= ▁minors . element At ( i ); ▁if ▁( ▁minors . element At ( i ) ▁< ▁leastVisits ▁ ) ▁leastVisits ▁= ▁minors . element At ( i ); ▁if ▁( ▁adults . element At ( i ) ▁> ▁mostVisits ▁ ) ▁mostVisits ▁= ▁adults . element At ( i ); ▁if ▁( ▁adults . element At ( i ) ▁< ▁leastVisits ▁ ) ▁leastVisits ▁= ▁adults . element At ( i ); ▁} ▁int ▁ GRAPH _ WIDTH ▁= ▁1 10 0 ; ▁int ▁ GRAPH _ HEIGHT ▁= ▁500 ; ▁int ▁ GRAPH _ VALUES ▁= ▁10 ; ▁if ▁( GRAPH _ VALUES > most Visit s ) ▁ GRAPH _ VALUES = most Visit s ; ▁if ▁( GRAPH _ VALUES == 0 ) ▁ GRAPH _ VALUES =1; ▁int ▁ VALUE _ HEIGHT ▁= ▁ GRAPH _ HEIGHT ▁/ ▁ GRAPH _ VALUES ; ▁int ▁DAY _ SP AC ING ▁= ▁ GRAPH _ WIDTH ▁/ ▁( NUM _ DAYS *2 ); ▁int ▁DAY _ WIDTH ▁= ▁DAY _ SP AC ING ▁/ ▁2 ; ▁int ▁ valueRange ▁= ▁mostVisits ▁- ▁leastVisits ; ▁// ▁buffer ▁the ▁values ▁mostVisits ▁+= ▁( int ) ( valueRange * 0 . 1 f ); ▁leastVisits ▁- = ▁( int ) ( valueRange * 0 . 1 f ); ▁if ▁( ▁leastVisits ▁< ▁0 ▁ ) ▁leastVisits ▁= ▁0; ▁ valueRange ▁= ▁mostVisits ▁- ▁leastVisits ; ▁double ▁value I nc ▁= ▁( double ) ▁ valueRange ▁/ ▁( double ) ▁ GRAPH _ VALUES ; ▁%> ▁< br ▁/> ▁< table ▁align =" center "> ▁< tr > ▁< td ▁align =" right " ▁v align =" bottom "> ▁< i ▁ style =" font - size : 7 5 % "> # ▁of ▁visits </ i > ▁</ td > ▁< td ▁align =" center " ▁v align =" top "> ▁< b > Visit s ▁Per ▁Month < br ▁/>< br ▁/></ b > ▁</ td > ▁</ tr > ▁< tr > ▁<!-- ▁value ▁le g end ▁--> ▁< td ▁v align =" top "> ▁< div ▁ style =" position : ▁relative "> ▁<% ▁int ▁val ; ▁for ▁( ▁int ▁i ▁= ▁0; ▁i ▁< = ▁ GRAPH _ VALUES ; ▁i ++ ▁ ) ▁{ ▁val ▁= ▁( int ) ▁( value I nc ▁* ▁i ); ▁int ▁to p ▁= ▁( ▁ GRAPH _ VALUES ▁- ▁i ▁ ) ▁* ▁ VALUE _ HEIGHT ; ▁%> ▁< div ▁ style =" position : ▁absolute ; ▁text - align : ▁right ; ▁width :100%; ▁height : ▁<%= VALUE _ HEIGHT %> px ; ▁to p : ▁<%= top %> px "> ▁<%= val %> ▁</ div > ▁<% ▁} ▁%> ▁</ div > ▁</ td > ▁<!-- ▁actual ▁ graph ▁--> ▁< td ▁v align =" top " ▁ style =" font - size : ▁ 50% ; ▁width : ▁<%= GRAPH _ WIDTH %> px ; ▁height : ▁<%= GRAPH _ HEIGHT %> px "> ▁< br ▁/> ▁< div ▁ style =" position : ▁relative ; font - size : 1 px "> ▁<% ▁for ▁( ▁int ▁i ▁= ▁0; ▁i ▁< = ▁ GRAPH _ VALUES ; ▁i ++ ▁ ) ▁{ ▁int ▁to p ▁= ▁( ▁ GRAPH _ VALUES ▁- ▁i ▁ ) ▁* ▁ VALUE _ HEIGHT ; ▁%> ▁< div ▁ style =" position : ▁absolute ; ▁back g round - color :# 666 ; ▁width :100%; ▁height : 1 px ; ▁to p : ▁<%= top %> px "></ div > ▁<% ▁} ▁for ▁( ▁int ▁i ▁= ▁0; ▁i ▁< ▁ NUM _ DAYS ; ▁i ++ ▁ ) ▁{ ▁int ▁left ▁= ▁( ▁( i *2 +1 ) ▁* ▁DAY _ SP AC ING ▁ ) ▁- ▁( ▁DAY _ WIDTH ▁/ ▁2 ▁ ); ▁int ▁height ▁= ▁( int ) ( GRAPH _ HEIGHT ▁* ▁( ( ▁minors . element At ( i ) ▁- ▁leastVisits ▁ ) ▁/ ▁( float ) ( valueRange ) )); ▁if ▁( ▁height ▁< = ▁0 ▁ ) ▁height ▁= ▁1; ▁int ▁ invHeight ▁= ▁ GRAPH _ HEIGHT ▁- ▁height ; ▁%> ▁< div ▁ style =" position : absolute ; top :<%= invHeight %> px ; left :<%= left %> px ; height :<%= height %> px ; width :<%= DAY _ WIDTH %> px ; back g round - color :# 0 0 66 FF ; border : ▁solid ▁1 px ▁# 0 0 99 FF ; ▁border - right : solid ▁1 px ▁# 0 0 3 3 66 ; ▁border - bottom : solid ▁1 px ▁# 0 0 3 3 66 "></ div > ▁<% ▁int ▁left 2 ▁= ▁( ▁( i *2+2) ▁* ▁DAY _ SP AC ING ▁ ) ▁- ▁( ▁DAY _ WIDTH ▁/ ▁2 ▁ ); ▁int ▁height 2 ▁= ▁( int ) ( GRAPH _ HEIGHT ▁* ▁( ( ▁adults . element At ( i ) ▁- ▁leastVisits ▁ ) ▁/ ▁( float ) ( valueRange ) )); ▁if ▁( ▁height 2 ▁< = ▁0 ▁ ) ▁height 2 ▁= ▁1; ▁int ▁ invHeight 2 ▁= ▁ GRAPH _ HEIGHT ▁- ▁height 2 ; ▁%> ▁< div ▁ style =" position : absolute ; top :<%= invHeight 2 %> px ; left :<%= left 2 %> px ; height :<%= height 2 %> px ; width :<%= DAY _ WIDTH %> px ; back g round - color :# CC 66 FF ; border : ▁solid ▁1 px ▁# CC 99 FF ; ▁border - right : solid ▁1 px ▁# CC 3 3 66 ; ▁border - bottom : solid ▁1 px ▁# CC 3 3 66 "></ div > ▁<% ▁} ▁%> ▁</ div > ▁</ td > ▁</ tr > ▁< tr > ▁< td ▁align =" right "> ▁< br ▁/>< br ▁/> ▁<%= ▁Date Start Str ▁%> ▁</ td > ▁< td ▁align =" right "> ▁< br ▁/>< br ▁/> ▁<%= ▁Date End Str ▁%> ▁</ td > ▁</ tr > ▁</ table > ▁<% ▁} ▁// ▁end ▁if ▁( ▁Day Count s ▁ != ▁null ▁ ) ▁} ▁} ▁%> ▁</ form > ▁<%@ ▁include ▁file ="/ resources / f ooter . jsp " ▁%> ▁</ body > ▁</ html >