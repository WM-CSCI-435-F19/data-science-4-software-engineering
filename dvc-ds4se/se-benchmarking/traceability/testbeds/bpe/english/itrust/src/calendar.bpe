▁<%@ page ▁error Page ="/ auth / exception Handler . jsp "%> ▁<%@ page ▁import =" edu . nc su . cs c . itrust . action . Generate CalendarAction "%> ▁<%@ page ▁import =" edu . nc su . cs c . itrust . action . View OfficeVisit Action "%> ▁<%@ page ▁import =" edu . nc su . cs c . itrust . beans . ApptBean "%> ▁<%@ page ▁import =" edu . nc su . cs c . itrust . beans . OfficeVisitBean "%> ▁<%@ page ▁import =" edu . nc su . cs c . itrust . beans . LabProcedureBean "%> ▁<%@ page ▁import =" edu . nc su . cs c . itrust . dao . DAOFactory "%> ▁<%@ page ▁import =" java . util . List "%> ▁<%@ page ▁import =" java . sql . Timestamp "%> ▁<%@ page ▁import =" java . util . ArrayList "%> ▁<%@ page ▁import =" java . util . Hashtable "%> ▁<%@ page ▁import =" java . util . Calendar "%> ▁<%@ include ▁file ="/ global . jsp " ▁%> ▁<% ▁pageTitle ▁= ▁" iTrust ▁- ▁Appointment ▁Calendar "; ▁%> ▁<%@ include ▁file ="/ header . jsp " ▁%> ▁<% ▁Generate CalendarAction ▁action ▁= ▁new ▁Generate CalendarAction ( prodDAO , ▁loggedInMID . longValue ()); ▁List < ApptBean > ▁send ; ▁boolean ▁conflicts [ ] ; ▁Hashtable < Integer , ▁ArrayList < ApptBean > > ▁a table ; ▁Hashtable < Integer , ▁ArrayList < OfficeVisitBean > > ▁rtable ; ▁Hashtable < Integer , ▁ArrayList < LabProcedureBean > > ▁ptable ; ▁// Calendar ▁S t uff ▁String ▁months [ ] ▁= ▁{ " January ", ▁" February ", ▁" March ", ▁" April ", ▁" May ", ▁" June ", ▁" July ", ▁" August ", ▁" September ", ▁" October ", ▁" November ", ▁" December " }; ▁String ▁weekDays [ ] ▁= ▁{ " S unday ", ▁" M onday ", ▁" T ue s day ", ▁" W ed nes day ", ▁" T hu rs day ", ▁" Fr i day ", ▁" Sat ur day " }; ▁Calendar ▁cal ▁= ▁Calendar . get Instance (); ▁int ▁orig Day ▁= ▁cal . get ( Calendar . DAY _ OF _ MONTH ); ▁int ▁orig Month ▁= ▁cal . get ( Calendar . MONTH ); ▁int ▁origYear ▁= ▁cal . get ( Calendar . YEAR ); ▁cal . set ( Calendar . DAY _ OF _ MONTH , ▁1); ▁int ▁ c _ month ▁= ▁cal . get ( Calendar . MONTH ); ▁// Change ▁Month ▁from ▁JSP ▁if ( request . getParameter (" c ") ▁ != ▁null ) ▁{ ▁String ▁cur ▁= ▁request . getParameter (" c "); ▁try ▁{ ▁ c _ month ▁= ▁Integer . parse Int ( cur ); ▁} ▁catch ▁( NumberFormat Exception ▁ nfe ) ▁{ ▁response . send Redirect (" calendar . jsp "); ▁} ▁} ▁int ▁month ▁= ▁ c _ month ; ▁if ( request . getParameter (" m ") ▁ != ▁null ) ▁{ ▁String ▁m ▁= ▁request . getParameter (" m "); ▁int ▁move ▁= ▁0; ▁try ▁{ ▁move ▁= ▁Integer . parse Int ( m ); ▁} ▁catch ▁( NumberFormat Exception ▁ nfe ) ▁{ ▁response . send Redirect (" calendar . jsp "); ▁} ▁month ▁= ▁ c _ month ▁+ ▁move ; ▁} ▁// L ine ▁to ▁set ▁month ▁direct ly ▁cal . set ( Calendar . MONTH , ▁month ); ▁int ▁thisMonth ▁= ▁cal . get ( Calendar . MONTH ); ▁int ▁thisYear ▁= ▁cal . get ( Calendar . YEAR ); ▁// Get ▁First ▁Day ▁of ▁Month ▁cal . set ( Calendar . DAY _ OF _ MONTH , ▁1); ▁int ▁firstDayOfMonth ▁= ▁cal . get ( Calendar . DAY _ OF _ WEEK ); ▁// Get ▁Last ▁Day ▁and ▁ Week ▁of ▁Month ▁cal . add ( Calendar . MONTH , ▁1); ▁cal . add ( Calendar . DAY _ OF _ MONTH , ▁-1) ; ▁int ▁lastDayOfMonth ▁= ▁cal . get ( Calendar . DAY _ OF _ MONTH ); ▁int ▁ lastWeekOfMonth ▁= ▁cal . get ( Calendar . WEEK _ OF _ MONTH ); ▁// Compile ▁Appointments ▁for ▁this ▁month ▁a table ▁= ▁action . getAppts Table ( thisMonth , ▁thisYear ); ▁send ▁= ▁action . get Send (); ▁conflicts ▁= ▁action . getC onflicts (); ▁// Compile ▁Office ▁Visits ▁for ▁this ▁month ▁rtable ▁= ▁action . getOfficeVisit s Table ( thisMonth , ▁thisYear ); ▁// Compile ▁Lab ▁Procedures ▁for ▁this ▁month ▁ptable ▁= ▁action . getLabProcedure s Table ( thisMonth , ▁thisYear ); ▁%> ▁< div ▁align =" center "> ▁< table ▁width =" 9 0%"> ▁< tr > ▁< td ▁ style =" text - align : ▁left ;"> ▁< a ▁href =" calendar . jsp ? c =<%= ▁month ▁%>& m = -1 "> Last </ a > ▁</ td > ▁< td ▁ style =" text - align : ▁center ;"> ▁< h 3 ><%= ▁" Appointments ▁for ▁"+ months [ thisMonth ] +" ▁"+ this Year ▁%></ h 3> ▁</ td > ▁< td ▁ style =" text - align : ▁right ;"> ▁< a ▁href =" calendar . jsp ? c =<%= ▁month ▁%>& m =1 "> Next </ a > ▁</ td > ▁</ tr > ▁</ table > ▁< table ▁id =" calendar Table " ▁border =" 1 px " ▁ style =" clear : ▁both ;"> ▁<% ▁out . print ("< tr > \ n "); ▁for ( String ▁d ▁: ▁weekDays ) ▁{ ▁out . print ("< th > "+ d +"</ th >"); ▁} ▁out . print (" </ tr > \ n "); ▁int ▁calDay ▁= ▁1 ▁+ ▁Calendar . S UN DAY ▁- ▁firstDayOfMonth ; ▁int ▁p ▁= ▁0; ▁for ( int ▁i =0; ▁i < lastWeekOfMonth ; ▁i ++) ▁{ ▁out . print ("< tr > \ n "); ▁for ( int ▁j =0; ▁j < 7 ; ▁j ++) ▁{ ▁if ( calDay ▁== ▁orig Day ▁&& ▁thisMonth ▁== ▁orig Month ▁&& ▁thisYear ▁== ▁origYear ) ▁out . print ("< td ▁class =\" today \ ">< div ▁class =\" cell \">" ); ▁else ▁out . print ("< td >< div ▁class =\" cell \">" ); ▁if ( calDay ▁> ▁0 ▁&& ▁calDay ▁< = ▁lastDayOfMonth ) ▁out . print ("< div ▁ style =\" float : ▁right ; \">"+ calDay +"</ div >"); ▁else ▁out . print ("< div ▁class =\" blank Day \ "></ div >"); ▁// Add ▁Appointments ▁to ▁Calendar ▁if ( a table . contains Key ( calDay )) ▁{ ▁ArrayList < ApptBean > ▁l ▁= ▁a table . get ( calDay ); ▁for ( ApptBean ▁b ▁: ▁l ) ▁{ ▁out . print ("< div ▁class =\" calendarEntry ▁"+ ( conflicts [ p ] ?" conf li ct " : "")+" ▁ \">"+ b . getApptType ()+" < br ▁/>< a ▁name =\""+ b . getApptType ()+"-"+ calDay + "\" ▁href =\" view Appt . jsp ? apt ="+ ▁p ++ ▁+ "\" ▁> Read ▁Details </ a ></ div >"); ▁} ▁} ▁// Add ▁Office ▁Visits ▁to ▁Calendar ▁if ( r table . contains Key ( calDay )) ▁{ ▁ArrayList < OfficeVisitBean > ▁l ▁= ▁rtable . get ( calDay ); ▁for ( OfficeVisitBean ▁b ▁: ▁l ) ▁{ ▁OfficeVisitBean ▁ov ▁= ▁new ▁View OfficeVisit Action ( prodDAO , ▁loggedInMID . longValue (), ▁b . get VisitID ()+" "). getOfficeVisit (); ▁String ▁in ▁= ▁( ov . getDiagnose s (). size () ▁== ▁0)?" Office ▁Visit " : ( ov . getDiagnose s (). get (0) . getICDCode ()+"-"+ ov . getDiagnose s (). get (0) . get Description ()); ▁out . print ("< div ▁class =\" calendarEntry \">"+ ( ( ov . getDiagnose s (). size () ▁== ▁0)?" Office ▁Visit " : in )+" < br ▁/>< a ▁name =\""+ in +"-"+ calDay + "\" ▁href =\" view OfficeVisit . jsp ? ovID ="+ ▁b . get VisitID () ▁+ "\" ▁> Read ▁Details </ a ></ div >"); ▁if ( ov . getPrescriptions (). size () ▁ != ▁0) ▁{ ▁String ▁in 2 ▁= ▁ov . getPrescriptions (). get (0) . get Medication (). getNDCode ()+"-"+ ov . getPrescriptions (). get (0) . get Medication (). get Description (); ▁out . print ("< div ▁class =\" calendarEntry \">"+ in 2 +" < br ▁/>< a ▁name =\""+ in 2 +"-"+ calDay + "\" ▁href =\" viewPrescription Information . jsp ? visitID ="+ ▁b . get VisitID () ▁+" & presID ="+ ▁ov . getPrescriptions (). get (0) . get Id () ▁+ "\" ▁> Read ▁Details </ a ></ div >"); ▁} ▁} ▁} ▁// Add ▁Lab ▁Procedures ▁to ▁Calendar ▁if ( p table . contains Key ( calDay )) ▁{ ▁ArrayList < LabProcedureBean > ▁l ▁= ▁ptable . get ( calDay ); ▁for ( LabProcedureBean ▁b ▁: ▁l ) ▁{ ▁out . print ("< div ▁class =\" calendarEntry \">"+ b . getLo inc ()+" < br ▁/>< a ▁name =\""+ b . getLo inc ()+"-"+ calDay + "\" ▁href =\" view LabProc . jsp ? id ="+ b . get Pid ()+" \ " ▁> Read ▁Details </ a ></ div >"); ▁} ▁} ▁calDay ++; ▁out . print (" </ div ></ td > \ n "); ▁} ▁out . print (" </ tr >"); ▁} ▁session . set Attribute (" appts ", ▁send ); ▁%> ▁</ table > ▁< br ▁/> ▁< br ▁/> ▁</ div > ▁<%@ include ▁file ="/ f ooter . jsp " ▁%>