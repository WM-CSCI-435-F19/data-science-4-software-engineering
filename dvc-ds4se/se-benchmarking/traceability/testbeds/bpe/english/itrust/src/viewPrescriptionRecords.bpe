▁<%@ tag lib ▁uri ="/ W EB - INF / tags . tld " ▁prefix =" itrust "%> ▁<%@ page ▁error Page ="/ auth / exception Handler . jsp "%> ▁<%@ page ▁import =" java . util . List "%> ▁<%@ page ▁import =" edu . nc su . cs c . itrust . action . View Prescription RecordsAction "%> ▁<%@ page ▁import =" edu . nc su . cs c . itrust . beans . PatientBean " ▁%> ▁<%@ page ▁import =" edu . nc su . cs c . itrust . beans . HCPLinkBean " ▁%> ▁<%@ page ▁import =" edu . nc su . cs c . itrust . beans . PrescriptionBean " ▁%> ▁<%@ page ▁import =" edu . nc su . cs c . itrust . exception . FormValidat ionException "%> ▁<%@ page ▁import = ▁" java . util . ArrayList "%> ▁<%@ page ▁import = ▁" java . util . Date "%> ▁<%@ page ▁import =" edu . nc su . cs c . itrust . dao . mysql . PatientDAO " ▁%> ▁<%@ include ▁file ="/ global . jsp "%> ▁<% ▁pageTitle ▁= ▁" iTrust ▁- ▁Get ▁My ▁Prescription ▁Report "; ▁%> ▁<%@ include ▁file ="/ header . jsp "%> ▁<% ▁List < HCPLinkBean > ▁LinkList ▁= ▁new ▁ArrayList < HCPLinkBean > (); ▁PatientBean ▁patient ▁= ▁new ▁PatientDAO ( prodDAO ) . getPatient ( loggedInMID . longValue ()); ▁View Prescription RecordsAction ▁action ▁= ▁new ▁View Prescription RecordsAction ( prodDAO , loggedInMID . longValue ()); ▁List < PatientBean > ▁representees ▁= ▁action . get Representees (); ▁boolean ▁ showMine ▁= ▁false ; ▁boolean ▁ showOther ▁= ▁false ; ▁boolean ▁a d E v ent ▁= ▁false ; ▁boolean ▁ s howAdverseButton ▁= ▁false ; ▁if ▁( request . getParameter (" mine ") ▁ != ▁null ▁&& ▁request . getParameter (" mine "). equals (" View ▁Current ")) ▁ showMine ▁= ▁true ; ▁if ▁( request . getParameter (" other ") ▁ != ▁null ▁&& ▁request . getParameter (" other "). equals (" View ")) ▁ showOther ▁= ▁true ; ▁if ▁( request . getParameter (" representee ") ▁ != ▁null ▁&& ▁request . getParameter (" representee "). equals (" -1 ")) ▁ showOther ▁= ▁false ; ▁if ▁( request . getParameter (" ad event ") ▁ != ▁null ▁&& ▁request . getParameter (" ad event "). equals (" Report ▁Adverse ▁Events ")){ ▁a d E v ent ▁= ▁true ; ▁int ▁check [ ] ▁= ▁new ▁int [100 ] ; ▁boolean ▁ oneChecked ▁= ▁false ; ▁for ( int ▁i ▁= ▁0; ▁i < 10 0 ; ▁i ++ ){ ▁if ▁( null ▁ != ▁request . getParameter (" check ing "+ i ) ▁&& ▁request . getParameter (" check ing "+ i ) . to Lower Case (). equals (" y ")) ▁{ ▁check [ i ] ▁= ▁1; ▁ oneChecked ▁= ▁true ; ▁} ▁} ▁List < HCPLinkBean > ▁l ▁= ▁( List < HCPLinkBean > ) ▁session . get Attribute (" bean list "); ▁int ▁i ▁= ▁0; ▁for ( HCPLinkBean ▁b ▁: ▁l ){ ▁if ( check [ i ] ▁== ▁1) ▁b . set Checked ( true ); ▁else ▁b . set Checked ( false ); ▁i ++; ▁} ▁session . set Attribute (" bean list ", ▁l ); ▁if ( oneChecked ){ ▁response . send Redirect (" re portAdverseEvent . jsp ? prescriptions = yes "); ▁} ▁else { %> ▁< div ▁align = center > ▁< span ▁class =" iTrust Error "><%= " M ust ▁report ▁on ▁at ▁least ▁one ▁prescription " ▁%></ span > ▁</ div > ▁<% ▁} ▁} ▁%> ▁< div ▁align =" center "> ▁< form ▁action =" viewPrescription Records . jsp " ▁method =" post "> ▁< table > ▁< tr > ▁< td > ▁< span ▁ style =" font - size : ▁24 px ; ▁ font - weight : ▁bold ;"> View ▁My ▁Own ▁ Prescriptions </ span > ▁</ td > ▁< td > ▁< input ▁type =" submit " ▁name =" mine " ▁value =" View ▁Current "></ input > ▁</ td > ▁</ tr > ▁< tr > ▁< td > ▁< span ▁ style =" font - size : ▁24 px ; ▁ font - weight : ▁bold ;"> View ▁ Other ' s ▁ Prescriptions </ span > ▁</ td > ▁<% ▁if ▁( representees . size () ▁> ▁0) ▁{ ▁%> ▁< td > ▁< select ▁name =" representee "> ▁< option ▁value =" -1 "></ option > ▁<% ▁int ▁index ▁= ▁0; ▁for ▁( PatientBean ▁representee ▁: ▁representees ) ▁{ ▁%> ▁< option ▁value ="<%= index ▁%>"><%= representee . getF ullName ()%></ option > ▁<% ▁index ▁++; ▁} ▁%> ▁</ select > ▁< input ▁type =" submit " ▁name =" other " ▁value =" View "></ input > ▁</ td > ▁<% ▁} ▁else ▁{ ▁%> ▁< td > ▁< i > You ▁are ▁not ▁anyone ' s ▁representative </ i > ▁</ td > ▁<% ▁} ▁%> ▁</ tr > ▁</ table > ▁</ form > ▁< br ▁/> ▁< table ▁class =" f Table "> ▁<% ▁if ▁( showMine ) ▁{ ▁List < PrescriptionBean > ▁prescriptions ▁= ▁action . getPrescription sForPatient ( loggedInMID . longValue ()); ▁if ▁( prescriptions . size () ▁== ▁0) ▁{ ▁%> ▁< tr > ▁< td ▁col span =4> ▁< i > No ▁prescriptions ▁found </ i > ▁</ td > ▁</ tr > ▁<% ▁} ▁else ▁{ ▁%> ▁< tr > ▁< th ▁col span = 5 ><%= ▁patient . getF ullName () ▁%></ th > ▁</ tr > ▁< tr ▁class =" subHeader "> ▁< td > ND ▁Code </ td > ▁< td > Description </ td > ▁< td > Duration </ td > ▁< td > Prescribing ▁HCP </ td > ▁< td > Report ▁Adverse ▁Event ▁( Y / N ) </ td > ▁</ tr > ▁<% ▁int ▁a ▁= ▁0; ▁ s howAdverseButton ▁= ▁true ; ▁for ▁( PrescriptionBean ▁prescription ▁: ▁prescriptions ) ▁{ ▁Date ▁date ▁= ▁new ▁Date (); ▁date . set Year ( date . get Year () -1 ); ▁if ( prescription . getEndDate (). after ( date )){ ▁%> ▁< tr > ▁< td ▁>< a ▁href =" viewPrescription Information . jsp ? visitID =<%= prescription . get VisitID ()%>& presID =<%= prescription . get Id ()%>"><%= prescription . get Medication (). getNDCode Formatted () ▁%></ a ></ td > ▁< td ▁><%= prescription . get Medication (). get Description () ▁%></ td > ▁< td ▁><%= prescription . getStartDate Str () ▁%> ▁to ▁<%= prescription . getEndDate Str () ▁%></ td > ▁< td ▁><%= action . get Prescribing Doctor ( prescription ) . getF ullName () ▁%></ td > ▁<% ▁ HCPLinkBean ▁HLbean ▁= ▁new ▁ HCPLinkBean (); ▁HLbean . setPrescriber MID ( action . get Prescribing Doctor ( prescription ) . get MID ()); ▁HLbean . set Drug ( prescription . get Medication (). get Description ()); ▁HLbean . set Code ( prescription . get Medication (). getNDCode ()); ▁LinkList . add ( HL bean ); ▁%> ▁< td > ▁< form ▁action =" viewPrescription Records . jsp " ▁method =" post "> ▁< input ▁name =" check ing <%= a %>" ▁type =" text " ▁value =" N " ▁size ="1" ▁maxlength ="1"> </ input ></ td > ▁<% a ++; %> ▁</ tr > ▁<% ▁} } ▁} ▁} ▁else ▁if ▁( showOther ) ▁{ ▁PatientBean ▁representee ▁= ▁representees . get ( Integer . parse Int ( request . getParameter (" representee ")) ); ▁%> ▁< tr > ▁< th ▁col span = 4 ><%= ▁representee . getF ullName () ▁%></ th > ▁</ tr > ▁<% ▁List < PrescriptionBean > ▁prescriptions ▁= ▁action . getPrescription sForPatient ( representee . get MID ()); ▁if ▁( prescriptions . size () ▁== ▁0) ▁{ ▁%> ▁< tr > ▁< td ▁col span =4> ▁< i > No ▁prescriptions ▁found </ i > ▁</ td > ▁</ tr > ▁<% ▁} ▁else ▁{ ▁%> ▁< tr ▁class =" subHeader "> ▁< td > ND ▁Code </ td > ▁< td > Description </ td > ▁< td > Duration </ td > ▁< td > Prescribing ▁HCP </ td > ▁</ tr > ▁<% ▁for ▁( PrescriptionBean ▁prescription ▁: ▁prescriptions ) ▁{ ▁%> ▁< tr > ▁< td ▁><%= prescription . get Medication (). getNDCode Formatted () ▁%></ td > ▁< td ▁><%= prescription . get Medication (). get Description () ▁%></ td > ▁< td ▁><%= prescription . getStartDate Str () ▁%> ▁to ▁<%= prescription . getEndDate Str () ▁%></ td > ▁< td ▁><%= ▁action . get Prescribing Doctor ( prescription ) . getF ullName () ▁%></ td > ▁</ tr > ▁<% ▁} ▁} ▁} ▁%> ▁</ table > ▁< br ▁/> ▁<% ▁if ▁( showMine ▁&& ▁ s howAdverseButton ) ▁{ ▁session . set Attribute (" bean list ", ▁LinkList ); ▁%> ▁< input ▁type =" submit " ▁name =" ad event " ▁value =" Report ▁Adverse ▁Events "></ input > ▁</ form > ▁<% ▁} ▁%> ▁</ div > ▁<%@ include ▁file ="/ f ooter . jsp "%>