▁<%@ tag lib ▁uri ="/ W EB - INF / tags . tld " ▁prefix =" itrust "%> ▁<%@ page ▁error Page ="/ auth / exception Handler . jsp "%> ▁<%@ page ▁import =" java . util . ArrayList "%> ▁<%@ page ▁import =" java . util . List "%> ▁<%@ page ▁import =" java . text . DateFormat "%> ▁<%@ page ▁import =" java . util . Date "%> ▁<%@ page ▁import =" edu . nc su . cs c . itrust . action . EditPHR Action "%> ▁<%@ page ▁import =" edu . nc su . cs c . itrust . beans . PatientBean "%> ▁<%@ page ▁import =" edu . nc su . cs c . itrust . beans . PersonnelBean "%> ▁<%@ page ▁import =" edu . nc su . cs c . itrust . beans . AllergyBean "%> ▁<%@ page ▁import =" edu . nc su . cs c . itrust . beans . FamilyMemberBean "%> ▁<%@ page ▁import =" edu . nc su . cs c . itrust . beans . HealthRecord "%> ▁<%@ page ▁import =" edu . nc su . cs c . itrust . beans . OfficeVisitBean "%> ▁<%@ page ▁import =" edu . nc su . cs c . itrust . beans . ProcedureBean "%> ▁<%@ page ▁import =" edu . nc su . cs c . itrust . action . View MyRecordsAction "%> ▁<%@ page ▁import =" edu . nc su . cs c . itrust . beans . LabProcedureBean "%> ▁<%@ page ▁import =" edu . nc su . cs c . itrust . dao . mysql . PatientDAO "%> ▁<%@ page ▁import =" edu . nc su . cs c . itrust . dao . mysql . PersonnelDAO "%> ▁<%@ include ▁file ="/ global . jsp "%> ▁<% ▁pageTitle ▁= ▁" iTrust ▁- ▁View ▁My ▁Records "; ▁%> ▁<%@ include ▁file ="/ header . jsp "%> ▁<% ▁session . remove Attribute (" personnelList "); ▁String ▁representee ▁= ▁request . getParameter (" rep "); ▁boolean ▁ isRepresenting ▁= ▁false ; ▁if ▁( representee ▁ != ▁null ▁&& ▁! " " . equals ( representee )) ▁{ ▁int ▁ representeeIndex ▁= ▁Integer . parse Int ( representee ); ▁List < PatientBean > ▁representees ▁= ▁( List < PatientBean > ) ▁session . get Attribute (" representees "); ▁if ( representees ▁ != ▁null ) ▁{ ▁loggedInMID ▁= ▁new ▁Long (" " ▁+ ▁representees . get ( representeeIndex ) . get MID ()); ▁// ▁session . remove Attribute (" representees "); ▁ isRepresenting ▁= ▁true ; ▁// ▁loggedInMID ▁= ▁new ▁Long ( action . re present Patient ( representee )); ▁%> ▁< span ▁> You ▁are ▁currently ▁viewing ▁your ▁representee ' s ▁records </ span >< br ▁/> ▁<% ▁} ▁} ▁PatientBean ▁patient ▁= ▁new ▁PatientDAO ( prodDAO ) . getPatient ( loggedInMID . longValue ()); ▁DateFormat ▁ df ▁= ▁DateFormat . getDate Instance (); ▁View MyRecordsAction ▁action ▁= ▁new ▁View MyRecordsAction ( prodDAO , ▁loggedInMID . longValue ()); ▁patient ▁= ▁action . getPatient (); ▁List < HealthRecord > ▁records ▁= ▁action . getAll HealthRecords (); ▁List < OfficeVisitBean > ▁officeVisits ▁= ▁action . get AllOfficeVisits (); ▁List < FamilyMemberBean > ▁family ▁= ▁action . get FamilyHistory (); ▁List < AllergyBean > ▁allergies ▁= ▁action . get Allergies (); ▁List < PatientBean > ▁represented ▁= ▁action . get Represented (); ▁List < LabProcedureBean > ▁procs ▁= ▁action . getLab s (); ▁%> ▁<% ▁if ▁( request . getParameter (" message ") ▁ != ▁null ) ▁{ ▁%> ▁< div ▁class =" iTrustMessage " ▁ style =" font - size : ▁24 px ; " ▁align = center > ▁<%= request . getParameter (" message ") ▁%> ▁</ div > ▁<% ▁} ▁%> ▁< br ▁/> ▁< table ▁align = center > ▁< tr > ▁< td > ▁< div ▁ style =" float : left ; ▁margin - right : 5 px ;"> ▁< table ▁class =" f Table " ▁border =1 ▁align =" center "> ▁< tr > ▁< th ▁col span ="2" ▁> Patient ▁Information </ th > ▁</ tr > ▁< tr > ▁< td ▁class =" subHeader V ertical "> Name :</ td > ▁< td ▁><%= patient . getF ullName ()%></ td > ▁</ tr > ▁< tr > ▁< td ▁class =" subHeader V ertical "> Address :</ td > ▁< td ▁> ▁<%= patient . getStreetAddress 1()%>< br ▁/> ▁<% =" " . equals ( patient . getStreetAddress 2 ()) ▁? ▁"" ▁: ▁patient . getStreetAddress 2() ▁+ ▁"< br ▁/> "%> ▁<%= patient . getStreetAddress 3 ()%>< br ▁/> ▁</ td > ▁</ tr > ▁< tr > ▁< td ▁class =" subHeader V ertical "> Phone :</ td > ▁< td ▁><%= patient . getPhone ()%></ td > ▁</ tr > ▁< tr > ▁< td ▁class =" subHeader V ertical "> Email :</ td > ▁< td ▁><%= patient . getEmail ()%></ td > ▁</ tr > ▁< tr > ▁< th ▁col span ="2"> ▁I nsurance ▁Information ▁</ th > ▁</ tr > ▁< tr > ▁< td ▁class =" subHeader V ertical "> ▁Provider ▁Name : ▁</ td > ▁< td ▁><%= patient . getIc Name ()%></ td > ▁</ tr > ▁< tr > ▁< td ▁class =" subHeader V ertical "> Address :</ td > ▁< td ▁> ▁<%= patient . getIcAddress 1()%>< br ▁/> ▁<% =" " . equals ( patient . getIcAddress 2 ()) ▁? ▁"" ▁: ▁patient ▁ . getIcAddress 2() ▁+ ▁"< br ▁/> "%> ▁<%= patient . getIcAddress 3 ()%>< br ▁/> ▁</ td > ▁</ tr > ▁< tr > ▁< td ▁class =" subHeader V ertical "> Phone :</ td > ▁< td ▁><%= patient . getIcPhone ()%></ td > ▁</ tr > ▁</ table > ▁</ div > ▁< div ▁ style =" float : ▁left ; ▁margin - left : ▁5 px ;"> ▁< table ▁class =" f Table " ▁border =1 ▁align =" center "> ▁< tr > ▁< th > Office ▁Visits </ th > ▁< th > Survey </ th > ▁</ tr > ▁<% ▁for ▁( OfficeVisitBean ▁ov ▁: ▁officeVisits ) ▁{ ▁%> ▁< tr > ▁< td ▁> ▁< a ▁href =" view OfficeVisit . jsp ? ovID =<%= ov . get VisitID ()%> <%= isRepresenting ▁? ▁"& repMID =" ▁+ ▁loggedInMID . longValue () ▁: ▁"" ▁%>"><%= df . format ( ov . getVisitDate ())%></ a ></ td > ▁<% ▁if ▁( action . is Survey Completed ( ov . get VisitID ())) ▁{ ▁%> ▁< td > & nb sp ; </ td > ▁<% ▁} ▁else ▁{ ▁%> ▁< td ▁> ▁< a ▁href =" survey . jsp ? ovID =<%= ov . get VisitID ()%>& ovDate =<%= df . format ( ov . getVisitDate ())%> "> ▁ Complete ▁Visit ▁Survey ▁</ a > ▁</ td > ▁<% ▁} ▁} ▁%> ▁</ tr > ▁< tr > ▁< td > & nb sp ; </ td > ▁</ tr > ▁< tr > ▁< td ▁col span =2 ▁align = center > ▁< a ▁href =" viewPrescription Records . jsp ? <%= isRepresenting ▁? ▁"& rep =" ▁+ ▁loggedInMID . longValue () ▁: ▁"" ▁%>"> ▁Get ▁ Prescriptions ▁</ a > ▁</ td > ▁</ tr > ▁</ table > ▁</ div > ▁</ td > ▁</ tr > ▁</ table > ▁< br ▁/> ▁< br ▁/> ▁< table ▁class =" f Table " ▁align =" center " ▁> ▁< tr > ▁< th ▁col span ="9" > ▁Family ▁Medica l ▁History ▁</ th > ▁</ tr > ▁< tr ▁class =" subHeader "> ▁< td > Name </ td > ▁< td > Relation </ td > ▁< td > High ▁Blood ▁Pressure </ td > ▁< td > High ▁Cholesterol </ td > ▁< td > Diabetes </ td > ▁< td > Cancer </ td > ▁< td > Heart ▁Disease </ td > ▁< td > Smoker </ td > ▁< td > Cause ▁of ▁Death </ td > ▁</ tr > ▁<% ▁if ▁( family . size () ▁== ▁0) ▁{ ▁%> ▁< tr > ▁< td ▁col span ="9" ▁ style =" text - align : ▁center ;"> ▁No ▁ Relation s ▁on ▁record ▁</ td > ▁</ tr > ▁<% ▁} ▁else ▁{ ▁for ▁( FamilyMemberBean ▁member ▁: ▁family ) ▁{ ▁%> ▁< tr > ▁< td ▁><%= member . getF ullName ()%></ td > ▁< td ▁><%= member . get Relation ()%></ td > ▁< td ▁align = center ><%= action . does FamilyMemberHave High BP ( member ) ▁? ▁" x " ▁: ▁" "%></ td > ▁< td ▁align = center ><%= action ▁ . does FamilyMemberHave High Cholesterol ( member ) ▁? ▁" x " ▁: ▁" "%></ td > ▁< td ▁align = center ><%= action ▁ . does FamilyMemberHave Diabetes ( member ) ▁? ▁" x " ▁: ▁" "%></ td > ▁< td ▁align = center ><%= action . does FamilyMemberHave Cancer ( member ) ▁? ▁" x " ▁: ▁" "%></ td > ▁< td ▁align = center ><%= action ▁ . does FamilyMemberHave HeartDisease ( member ) ▁? ▁" x " ▁: ▁" "%></ td > ▁< td ▁align = center ><%= action . is FamilyMember Smoker ( member ) ▁? ▁" x " ▁: ▁" "%></ td > ▁< td ▁><%= action . get FamilyMember COD ( member )%></ td > ▁</ tr > ▁<% ▁} ▁} ▁%> ▁</ table > ▁< br ▁/> ▁< br ▁/> ▁< table ▁align = center > ▁< tr > ▁< td > ▁< div ▁ style =" float : left ; ▁margin - right : 5 px ;"> ▁< table ▁class =" f Table " ▁align =" center " ▁> ▁< tr > ▁< th ▁col span ="2"> Allergies </ th > ▁</ tr > ▁< tr ▁class =" subHeader "> ▁< td > Allergy ▁Description </ td > ▁< td > First ▁Found </ td > ▁</ tr > ▁<% ▁if ▁( all er g ies . size () ▁== ▁0) ▁{ ▁%> ▁< tr > ▁< td ▁col span ="2" ▁> No ▁Allergies ▁on ▁record </ td > ▁</ tr > ▁<% ▁} ▁else ▁{ ▁for ▁( AllergyBean ▁allergy ▁: ▁allergies ) ▁{ ▁%> ▁< tr > ▁< td ▁><%= allergy . get Description ()%></ td > ▁< td ▁><%= df . format ( allergy . getFirstFound ())%></ td > ▁</ tr > ▁<% ▁} ▁} ▁%> ▁</ table > ▁</ div > ▁< div ▁ style =" float : left ; ▁margin - left : 5 px ;"> ▁< table ▁class =" f Table "> ▁< tr > ▁< th > ▁Patients ▁<%= patient . get FirstName ()%> ▁ Represent s ▁</ th > ▁</ tr > ▁< tr ▁class =" subHeader "> ▁< td > Patient </ td > ▁</ tr > ▁<% ▁if ▁( rep resented . size () ▁== ▁0) ▁{ ▁%> ▁< tr > ▁< td ▁> ▁<%= patient . get FirstName ()%> ▁is ▁not ▁representing ▁any ▁patients ▁</ td > ▁</ tr > ▁<% ▁} ▁else ▁{ ▁int ▁index ▁= ▁0; ▁for ▁( PatientBean ▁p ▁: ▁represented ) ▁{ ▁%> ▁< tr > ▁< td ▁> ▁<% ▁if ( isRepresenting ) ▁{ ▁%> ▁<%= p . getF ullName ()%> ▁<% ▁} ▁else ▁{ ▁%> ▁< a ▁href =" v iewMyRecords . jsp ? rep =<%= index %>"><%= p . getF ullName ()%></ a > ▁<% ▁} ▁%> ▁</ td > ▁</ tr > ▁<% ▁index ++; ▁} ▁if (! isRepresenting ) ▁{ ▁session . set Attribute (" representees ", ▁represented ); ▁} ▁} ▁%> ▁</ table > ▁</ div > ▁</ td ></ tr > ▁</ table > ▁< br ▁/> ▁< br ▁/> ▁< table ▁class =" f Table " ▁align =" center "> ▁< tr > ▁< th ▁col span ="10"> ▁Basic ▁Health ▁History ▁</ th > ▁</ tr > ▁< tr ▁class =" subHeader " ▁> ▁< td > Height </ td > ▁< td > Weight </ td > ▁< td > Smoke s ?</ td > ▁< td > Blood ▁Pressure </ td > ▁< td > HDL </ td > ▁< td > LDL </ td > ▁< td > Triglycerides </ td > ▁< td > Total ▁Cholesterol </ td > ▁< td > Last ▁Recorded </ td > ▁< td > By ▁Personnel </ td > ▁</ tr > ▁<% ▁if ( records . size () ▁> ▁0) ▁{ ▁List < PersonnelBean > ▁personnelList ▁= ▁new ▁ArrayList < PersonnelBean > (); ▁int ▁index ▁= ▁0; ▁for ▁( HealthRecord ▁hr ▁: ▁records ) ▁{ ▁%> ▁< tr > ▁< td ▁><%= hr . get Height ()%> in </ td > ▁< td ▁><%= hr . get Weight ()%> lbs </ td > ▁< td ▁><%= hr . isSmoker () ▁? ▁" Y " ▁: ▁" N "%></ td > ▁< td ▁><%= hr . getBloodPressure ()%> ▁mmHg </ td > ▁< td ▁><%= hr . get CholesterolHDL ()%> ▁mg / dL </ td > ▁< td ▁><%= hr . get CholesterolLDL ()%> ▁mg / dL </ td > ▁< td ▁><%= hr . get CholesterolTri ()%> ▁mg / dL </ td > ▁< td ▁><%= hr . getTotalC holesterol ()%> ▁mg / dL </ td > ▁< td ▁><%= df . format ( hr . getDate Recorded ())%></ td > ▁<% ▁PersonnelBean ▁personnel ▁= ▁new ▁PersonnelDAO ( prodDAO ) . getPersonnel ( hr . getPersonnelID ()); ▁personnelList . add ( personnel ); ▁%> ▁< td ▁>< a ▁href ="/ iTrust / auth / view Personnel . jsp ? personnel =<%= index %>"><%= personnel . getF ullName ()%></ a ></ td > ▁</ tr > ▁<% ▁index ++; ▁} ▁session . set Attribute (" personnelList ", ▁personnelList ); ▁} ▁else ▁{ ▁%> ▁< tr > ▁< td ▁col span =1 1 ▁align = center > ▁No ▁Data ▁</ td > ▁</ tr > ▁<% ▁} ▁%> ▁</ table > ▁< br ▁/> ▁< br ▁/> ▁< table ▁class =" f Table " ▁align =" center "> ▁< tr > ▁< th ▁col span ="11"> Lab ▁Procedures </ th > ▁</ tr > ▁< tr ▁class =" subHeader "> ▁< td > Patient </ td > ▁< td > Lab ▁Code </ td > ▁< td > Status </ td > ▁< td > Results </ td > ▁< td > OfficeVisitID </ td > ▁< td > Commentary </ td > ▁< td > Updated ▁Date </ td > ▁</ tr > ▁<% ▁if ( proc s . size () ▁> ▁0 ▁ ) ▁{ ▁for ▁( LabProcedureBean ▁bean ▁: ▁procs ) ▁{ ▁%> ▁< tr > ▁< td ▁><%= patient . getF ullName ()%></ td > ▁< td ▁><%= bean . getLo inc ()%></ td > ▁< td ▁><%= bean . get Status ()%></ td > ▁< td ▁><%= bean . get Results ()%></ td > ▁< td ▁><%= bean . getOv ID ()%></ td > ▁< td ▁><%= bean . get Commentary ()%></ td > ▁< td ▁><%= df . format ( bean . get Timestamp ())%></ td > ▁</ tr > ▁<% ▁} ▁} ▁else ▁{ ▁%> ▁< tr > ▁< td ▁col span =1 1 ▁align = center > ▁No ▁Data ▁</ td > ▁</ tr > ▁<% ▁} ▁%> ▁</ table > ▁< br ▁/> ▁< br ▁/> ▁< table ▁class =" f Table " ▁align =" center "> ▁< tr > ▁< th ▁col span ="4"> Immunizations </ th > ▁</ tr > ▁< tr ▁class =" subHeader "> ▁< td > CPT ▁Code </ th > ▁< td > Description </ th > ▁< td > Date ▁ Received </ th > ▁< td > Adverse ▁Event </ th > ▁</ tr > ▁<% ▁boolean ▁ hasNoData ▁= ▁true ; ▁for ▁( OfficeVisitBean ▁ov : ▁officeVisits ) ▁{ ▁List < ProcedureBean > ▁ov Pro cs ▁= ▁action . get Complete OfficeVisit ( ov . get VisitID ()). get Procedures (); ▁for ▁( ProcedureBean ▁proc : ▁ov Pro cs ) ▁{ ▁if ▁( null ▁ != ▁proc . get Attribute () ▁&& ▁proc . get Attribute (). equals (" immunization ")) ▁{ ▁ hasNoData = false ; ▁%> ▁< tr > ▁< td ><%= proc . getCPTCode ()%></ td > ▁< td ><%= proc . get Description () ▁%></ td > ▁< td ><%= proc . getDate () ▁%></ td > ▁< td > ▁<% ▁Date ▁date ▁= ▁new ▁Date (); ▁date . set Year ( date . get Year () -1 ); ▁if ( proc . getDate (). after ( date )){ ▁%> ▁< a ▁href =" re portAdverseEvent . jsp ? presID =<%= proc . get Description ()%>& HCPMID =<%= ov . getHcp ID () ▁%>& code =<%= proc . getCPTCode ()%>"> Report </ a > ▁<% ▁} %></ td ></ tr ><% ▁} ▁} ▁} ▁if ( hasNoData ) ▁{ ▁%> ▁< tr > ▁< td ▁col span = 4 ▁align = center > ▁No ▁Data ▁</ td > ▁</ tr > ▁<% ▁} ▁%> ▁</ table > ▁< br ▁/> ▁<%@ include ▁file ="/ f ooter . jsp "%>