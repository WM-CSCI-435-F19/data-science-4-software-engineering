▁<%@ page ▁import =" edu . nc su . cs c . itrust . action . LoginFailure Action "%> ▁<%@ page ▁import =" edu . nc su . cs c . itrust . dao . DAOFactory "%> ▁<%@ page ▁import =" edu . nc su . cs c . itrust . dao . mysql . AuthDAO "%> ▁<% ▁DAOFactory ▁prodDAO ▁= ▁DAOFactory . getPr oductionInstance (); ▁AuthDAO ▁authDAO ▁= ▁prodDAO . get AuthDAO (); ▁LoginFailure Action ▁login Failure Action ▁= ▁new ▁LoginFailure Action ( prodDAO , ▁request . getRemote Addr ()); ▁String ▁pageTitle ▁= ▁null ; ▁String ▁ loginMessage ▁= ▁null ; ▁String ▁ userName ▁= ▁null ; ▁// " And y ▁ Pro g r ammer "; ▁String ▁errorMessage ▁= ▁null ; ▁boolean ▁ validSession ▁= ▁true ; ▁Long ▁loggedInMID ▁= ▁new ▁Long ( 0 L ); ▁String ▁userRole ▁= ▁""; ▁try ▁{ ▁loggedInMID ▁= ▁( Long ) ▁session . get Attribute (" loggedInMID "); ▁userRole ▁= ▁( String ) ▁session . get Attribute (" userRole "); ▁if ▁( userRole ▁== ▁null ) ▁{ ▁if ▁( request . is UserIn Role (" patient ")) ▁{ ▁userRole ▁= ▁" patient "; ▁} ▁else ▁if ▁( request . is UserIn Role (" uap ")) ▁{ ▁userRole ▁= ▁" uap "; ▁} ▁else ▁if ▁( request . is UserIn Role (" hcp ")) ▁{ ▁userRole ▁= ▁" hcp "; ▁} ▁else ▁if ▁( request . is UserIn Role (" er ")) ▁{ ▁userRole ▁= ▁" er "; ▁} ▁else ▁if ▁( request . is UserIn Role (" admin ")) ▁{ ▁userRole ▁= ▁" admin "; ▁} ▁else ▁if ▁( request . is UserIn Role (" pha ")) ▁{ ▁userRole ▁= ▁" pha "; ▁} ▁else ▁if ▁( request . is UserIn Role (" tester ")) ▁{ ▁userRole ▁= ▁" tester "; ▁} ▁session . set Attribute (" userRole ", ▁userRole ); ▁} ▁} ▁catch ▁( Illegal StateException ▁is e ) ▁{ ▁ validSession ▁= ▁false ; ▁} ▁%>