▁<%@ page ▁import =" edu . nc su . cs c . itrust . action . Report AdverseEvent Action "%> ▁<%@ page ▁import =" edu . nc su . cs c . itrust . beans . AdverseEventBean "%> ▁<%@ page ▁import =" edu . nc su . cs c . itrust . beans . PatientBean "%> ▁<%@ page ▁import =" edu . nc su . cs c . itrust . beans . HCPLinkBean "%> ▁<%@ page ▁import =" edu . nc su . cs c . itrust . BeanBuilder "%> ▁<%@ page ▁import =" edu . nc su . cs c . itrust . beans . PersonnelBean "%> ▁<%@ page ▁import =" java . util . List "%> ▁<%@ page ▁import = ▁" java . util . ArrayList "%> ▁<%@ tag lib ▁uri ="/ W EB - INF / tags . tld " ▁prefix =" itrust " ▁%> ▁<%@ page ▁error Page ="/ auth / exception Handler . jsp " ▁%> ▁<%@ include ▁file ="/ global . jsp "%> ▁<% ▁pageTitle ▁= ▁" iTrust ▁- ▁Report ▁Adverse ▁Event "; ▁%> ▁<%@ include ▁file ="/ header . jsp "%> ▁<% ▁Report AdverseEvent Action ▁action ; ▁if ( request . getParameter (" Comment ") ▁ != ▁( null ) ▁&& ▁session . get Attribute (" HCPMID ") ▁== ▁null ){ ▁List < HCPLinkBean > ▁link List ▁= ▁new ▁ArrayList < HCPLinkBean > (); ▁link List ▁= ▁( List < HCPLinkBean > ) ▁session . get Attribute (" bean list "); ▁List < AdverseEventBean > ▁adverse List ▁= ▁new ▁ArrayList < AdverseEventBean > (); ▁boolean ▁bad ▁= ▁false ; ▁for ( HCPLinkBean ▁ lBean ▁: ▁link List ){ ▁if ▁( lBean . is Checked ()){ ▁action ▁= ▁new ▁Report AdverseEvent Action (" " ▁+ ▁ lBean . getPrescriber MID (), ▁prodDAO , ▁loggedInMID . longValue ()); ▁ AdverseEventBean ▁aeBean ▁= ▁new ▁ AdverseEventBean (); ▁aeBean . set MID (""+ loggedInMID ); ▁aeBean . set Description ( request . getParameter (" Comment ")); ▁aeBean . set Drug (""+ lBean . getDrug ()); ▁aeBean . set Code (""+ lBean . get Code ()); ▁aeBean . setPrescriber (" " ▁+ ▁ lBean . getPrescriber MID ()); ▁adverse List . add ( aeBean ); ▁String ▁ msg ▁= ▁action . addReport ( aeBean ); ▁if (! msg . equals (" ")){ ▁bad ▁= ▁true ; ▁%> ▁< div ▁align = center > ▁< span ▁class =" iTrust Error "><%= msg ▁%></ span > ▁</ div > ▁<% ▁} ▁} ▁} ▁action ▁= ▁new ▁Report AdverseEvent Action ( prodDAO , ▁loggedInMID . longValue ()); ▁action . sendMail s ( ad ver se List ); ▁if (! bad ){ ▁response . send Redirect (" home . jsp ? rep =1 "); ▁} ▁} ▁if ( request . getParameter (" Comment ") ▁ != ▁( null ) ▁&& ▁session . get Attribute (" HCPMID ") ▁ != ▁null ){ ▁action ▁= ▁new ▁Report AdverseEvent Action (" " ▁+ ▁session . get Attribute (" HCPMID "), ▁prodDAO , ▁loggedInMID . longValue ()); ▁ AdverseEventBean ▁aeBean ▁= ▁new ▁ AdverseEventBean (); ▁aeBean . set MID (""+ loggedInMID ); ▁aeBean . set Description ( request . getParameter (" Comment ")); ▁aeBean . set Drug (""+ session . get Attribute (" presID ")); ▁aeBean . set Code (""+ session . get Attribute (" code ")); ▁// aeBean ▁= ▁new ▁ BeanBuilder < AdverseEventBean > (). build ( request . getParameterMap (), ▁new ▁ AdverseEventBean ()); ▁action . addReport ( aeBean ); ▁action . sendMail ( aeBean ); ▁response . send Redirect (" home . jsp ? rep =1 "); ▁} ▁if ( request . getParameter (" Comment ") ▁== ▁( null ) ▁&& ▁request . getParameter (" HCPMID ") ▁ != ▁null ){ ▁action ▁= ▁new ▁Report AdverseEvent Action ( request . getParameter (" HCPMID "), ▁prodDAO , ▁loggedInMID . longValue ()); ▁session . set Attribute (" HCPMID ", ▁request . getParameter (" HCPMID ")); ▁session . set Attribute (" presID ", ▁request . getParameter (" presID ")); ▁session . set Attribute (" code ", ▁request . getParameter (" code ")); ▁} ▁%> ▁< div ▁align =" center "> ▁< form ▁id =" mainForm " ▁method =" get " ▁action =" re portAdverseEvent . jsp "> ▁< h 2> Report ▁an ▁Adverse ▁Event </ h 2> ▁< textarea ▁name =" Comment " ▁cols ="100 " ▁rows ="10"> </ textarea >< br ▁/> ▁< br ▁/> ▁< input ▁type =" submit " ▁value =" Save " ▁name =" addReport "/> ▁</ form > ▁</ div > ▁<%@ include ▁file ="/ f ooter . jsp "%>