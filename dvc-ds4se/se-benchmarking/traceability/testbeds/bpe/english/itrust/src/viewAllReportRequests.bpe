▁<%@ tag lib ▁uri ="/ W EB - INF / tags . tld " ▁prefix =" itrust " ▁%> ▁<%@ page ▁error Page ="/ auth / exception Handler . jsp " ▁%> ▁<%@ page ▁import =" java . util . List "%> ▁<%@ page ▁import =" edu . nc su . cs c . itrust . beans . R eportRequestBean "%> ▁<%@ page ▁import =" edu . nc su . cs c . itrust . dao . DAOFactory "%> ▁<%@ page ▁import =" edu . nc su . cs c . itrust . action . ViewMyReport RequestsAction "%> ▁<%@ page ▁import =" edu . nc su . cs c . itrust . beans . PatientBean "%> ▁<%@ page ▁import =" edu . nc su . cs c . itrust . beans . PersonnelBean "%> ▁<%@ page ▁import =" edu . nc su . cs c . itrust . dao . mysql . PatientDAO "%> ▁<%@ page ▁import =" edu . nc su . cs c . itrust . dao . mysql . PersonnelDAO "%> ▁<%@ include ▁file ="/ global . jsp " ▁%> ▁<% ▁pageTitle ▁= ▁" iTrust ▁- ▁View ▁All ▁Report ▁Requests "; ▁%> ▁<%@ include ▁file ="/ header . jsp " ▁%> ▁<% ▁PatientDAO ▁patientDAO ▁= ▁prodDAO . get PatientDAO (); ▁PersonnelDAO ▁personnelDAO ▁= ▁prodDAO . get PersonnelDAO (); ▁PersonnelBean ▁personnelb ▁= ▁personnelDAO . getPersonnel ( loggedInMID . longValue ()); ▁ViewMyReport RequestsAction ▁action ▁= ▁new ▁ViewMyReport RequestsAction ( prodDAO , ▁loggedInMID . longValue ()); ▁String ▁action String ▁= ▁request . getParameter (" Action "); ▁String ▁id String ▁= ▁request . getParameter (" ID "); ▁if ▁( action String ▁ != ▁null ▁&& ▁! action String . equals ("")) ▁{ ▁if ▁( idString ▁ != ▁null ▁&& ▁! idString . equals ("") ▁&& ▁action String . equals (" Approve ")) ▁{ ▁try ▁{ ▁long ▁ID ▁= ▁Long . parse Long ( idString ); ▁action . approve ReportRequest ( ID ); ▁%> ▁< div ▁align = center > ▁< span ▁class =" iTrustMessage "> Report ▁Request ▁ Approved </ span > ▁</ div > ▁<% ▁} ▁catch ▁( Exception ▁e ) ▁{ ▁%> ▁< div ▁align = center > ▁< span ▁class =" iTrust Error "><%= e . getMessage () ▁%></ span > ▁</ div > ▁<% ▁} ▁} ▁if ▁( idString ▁ != ▁null ▁&& ▁! idString . equals ("") ▁&& ▁action String . equals (" Confirm ")) ▁{ ▁try ▁{ ▁long ▁ID ▁= ▁Long . parse Long ( idString ); ▁String ▁comment ▁= ▁request . getParameter (" Comment "); ▁// n e ed ▁validation ▁here ▁- ▁st ud ent s ▁did ▁it ▁w rong ▁last ▁year ▁and ▁we ▁n ever ▁fixed ▁it ▁action . reject ReportRequest ( ID , ▁comment ); ▁%> ▁< div ▁align = center > ▁< span ▁class =" iTrust Error "> Report ▁Request ▁ Rejected </ span > ▁</ div > ▁<% ▁} ▁catch ▁( Exception ▁e ) ▁{ ▁%> ▁< div ▁align = center > ▁< span ▁class =" iTrust Error "><%= e . getMessage () ▁%></ span > ▁</ div > ▁<% ▁} ▁} ▁} ▁List < R eportRequestBean > ▁list ▁= ▁action . getAll ReportRequests (); ▁%> ▁< br ▁/> ▁< table ▁align =" center " ▁class =" f Table "> ▁< tr > ▁< th ▁col span ="10"> Report ▁Requests </ th > ▁</ tr > ▁< tr ▁class =" subHeader "> ▁< th > ID </ th > ▁< th > Patient </ th > ▁< th > Approve r </ th > ▁< th > Requested ▁Date </ th > ▁< th > Approved ▁Date </ th > ▁< th > Viewed ▁Date </ th > ▁< th > Status </ th > ▁< th > Comment </ th > ▁< th > Action </ th > ▁</ tr > ▁<% for ▁( R eportRequestBean ▁bean : list ) ▁{ ▁PatientBean ▁patient ▁= ▁patientDAO . getPatient ( bean . get PatientMID ()); ▁PersonnelBean ▁approve r ▁= ▁( bean . get ApproverMID () ▁== ▁0 L ) ▁? ▁null ▁: ▁personnelDAO . getPersonnel ( bean . get ApproverMID ()); ▁%> ▁< tr > ▁< td ▁><%= bean . get ID ()%></ td > ▁< td ▁><%= patient . getF ullName ()%></ td > ▁< td ▁><%= ( approve r ▁== ▁null ) ▁? ▁"" ▁: ▁approve r . getF ullName ()%>< ! -- ▁--> </ td > ▁< td ▁><%= bean . getRequestedDate String ()%></ td > ▁< td ▁><%= bean . getApprovedDate String ()%></ td > ▁< td ▁><%= bean . getViewedDate String ()%></ td > ▁< td ▁><%= bean . get Status ()%></ td > ▁< td ▁><%= bean . getComment () ▁== ▁null ▁? ▁"" ▁: ▁bean . getComment ()%></ td > ▁< td ▁ ><% if ( bean . get Status (). equals ( R eportRequestBean . Requested )){ ▁%> ▁< a ▁href =" viewA llReportRequests . jsp ? Action = Approve & ID =<%= bean . get ID ()%>"> Approve </ a > ▁< a ▁href =" viewA llReportRequests . jsp ? Action = Reject & ID =<%= bean . get ID ()%>"> Reject </ a > ▁<%} else { %>& nb sp ; <% } ▁%></ td > ▁</ tr > ▁<% if ▁( action String ▁ != ▁null ▁&& ▁action String . equals (" Reject ")) ▁{ ▁long ▁ID ▁= ▁Long . parse Long ( idString ); ▁if ▁( ID ▁== ▁bean . get ID ()) ▁{ ▁%>< tr >< td ▁col span =5> P lease ▁enter ▁a ▁reason ▁for ▁the ▁reject ion ▁and ▁confirm </ td > ▁< td ▁col span =4> ▁< form ▁action =" viewA llReportRequests . jsp " ▁method =" post " ▁name =" mainForm "> ▁< input ▁type =" hidden " ▁name =" Action " ▁value =" Confirm "> ▁< input ▁type =" hidden " ▁name =" ID " ▁value ="<%= bean . get ID ()%>"> ▁< input ▁type =" text " ▁name =" Comment " ▁size = 40 > ▁< input ▁type =" submit " ▁value =" Confirm "> ▁</ form > ▁</ td ></ tr > ▁<%} ▁} ▁} ▁%> ▁</ table > ▁< br ▁/> ▁<%@ include ▁file ="/ f ooter . jsp " ▁%>