▁<%@ page ▁error Page ="/ auth / exception Handler . jsp " ▁%> ▁<%@ page ▁import =" java . util . List "%> ▁<%@ page ▁import =" java . util . Date "%> ▁<%@ page ▁import =" java . text . SimpleDateFormat "%> ▁<%@ page ▁import =" edu . nc su . cs c . itrust . action . Monitor AdverseEvent Action "%> ▁<%@ page ▁import =" edu . nc su . cs c . itrust . beans . AdverseEventBean "%> ▁<%@ page ▁import =" edu . nc su . cs c . itrust . exception . FormValidat ionException "%> ▁<%@ include ▁file ="/ global . jsp " ▁%> ▁<% ▁pageTitle ▁= ▁" iTrust ▁- ▁Monitor ▁Adverse ▁Events "; ▁%> ▁<%@ include ▁file ="/ header . jsp " ▁%> ▁< script > ▁function ▁show B ar Chart ( id ) ▁{ ▁id ▁= ▁id . substring (5, ▁id . index Of (" button ")); ▁ window . open (" b ar chart . jsp ? id =" ▁+ ▁id , ▁" b ar chart ", ▁" width = 3 00, ▁height = 3 00, ▁res iz able = yes "); ▁} ▁</ script > ▁<% ▁Monitor AdverseEvent Action ▁action ▁= ▁new ▁Monitor AdverseEvent Action ( prodDAO , ▁loggedInMID . longValue ()); ▁List < AdverseEventBean > ▁events ▁= ▁null ; ▁String ▁prescription Immunization ▁= ▁""; ▁if ( request . getParameter (" prescriptions ") ▁ != ▁null ) ▁{ ▁try { ▁events ▁= ▁action . get Report s ( true , ▁request . getParameter (" startDate "), ▁request . getParameter (" endDate ")); ▁prescription Immunization ▁= ▁" Prescription "; ▁} ▁catch ( FormValidat ionException ▁e ){ ▁%> ▁< div ▁align = center > ▁< span ▁class =" iTrust Error "><%= e . getMessage () ▁%></ span > ▁</ div > ▁<% ▁} ▁} ▁else ▁if ( request . getParameter (" immunization s ") ▁ != ▁null ) ▁{ ▁try { ▁events ▁= ▁action . get Report s ( false , ▁request . getParameter (" startDate "), ▁request . getParameter (" endDate ")); ▁prescription Immunization ▁= ▁" Immunization "; ▁} ▁catch ( FormValidat ionException ▁e ){ ▁%> ▁< div ▁align = center > ▁< span ▁class =" iTrust Error "><%= e . getMessage () ▁%></ span > ▁</ div > ▁<% ▁} ▁} ▁if ( prescription Immunization ▁ != ▁" ") ▁{ ▁session . set Attribute (" events ", ▁events ); ▁session . set Attribute (" prescription Immunization ", ▁prescription Immunization ); ▁%> ▁< form ▁action =" adverseEvent Details . jsp " ▁method =" post "> ▁< input ▁type =" hidden " ▁name =" eventNumber " ▁value =" " ▁/> ▁< table ▁class =" f Table " ▁align =" center "> ▁< tr ▁class =" header "> ▁< th ><%= prescription Immunization ▁%></ th > ▁< th > Reporter </ th > ▁< th > Date </ th > ▁< th > Details </ th > ▁< th ><%= prescription Immunization ▁%> ▁Reports ▁ By ▁Month </ th > ▁</ tr > ▁<% ▁int ▁i ▁= ▁0; ▁int ▁ codeCount ▁= ▁0; ▁String ▁ currentCode ▁= ▁""; ▁if ( events . size () ▁> ▁0){ ▁ currentCode ▁= ▁events . get (0) . get Code (); ▁} ▁else ▁{ ▁%> ▁< tr >< td ▁col span ="5" ▁align =" center "> No ▁adverse ▁events ▁reported . </ td ></ tr > ▁<% ▁} ▁for ( AdverseEventBean ▁event : ▁events ){ ▁if (! " removed " . equals ( event . get Status ())){ ▁%> ▁< tr >< td > ▁<% ▁if ( currentCode . equals ( event . get Code ())) ▁{ ▁ codeCount ++; ▁} ▁else ▁{ ▁%> ▁< script > ▁document . getElementById (" chart <%= currentCode ▁%> "). row Span ▁= ▁<%= codeCount %> ; ▁</ script > ▁<% ▁ codeCount ▁= ▁1; ▁ currentCode ▁= ▁event . get Code (); ▁} ▁%> ▁<%= event . getDrug () ▁%> ( <%= event . get Code () ▁ %>)</ td > ▁<% ▁try ▁{ ▁%> ▁< td ><%= action . getName ( Long . parse Long ( event . get MID ())) ▁%></ td > ▁<% ▁} ▁catch ( NumberFormat Exception ▁e ) ▁{ ▁%> ▁< td > I nvalid ▁Patient ▁ID </ td > ▁<% ▁} ▁%> ▁< td ><%= event . getDate () ▁%></ td > ▁< td > ▁< a ▁href =" adverseEvent Details . jsp ? eventNumber =<%= i ▁%>"> Get ▁Details </ a ></ td > ▁<% ▁if ( codeCount ▁== ▁1) ▁{ ▁%> ▁< td ▁id =" chart <%= currentCode ▁%>" ▁row span ="1"> ▁< a ▁href =" adverseEvent Chart . jsp ? code =<%= currentCode ▁%>"> View ▁ Chart </ a > ▁</ td > ▁<% ▁} ▁%> ▁</ tr > ▁<% ▁} ▁i ++; ▁} ▁%> ▁</ table > ▁< script > ▁document . getElementById (" chart <%= currentCode ▁%> "). row Span ▁= ▁" <%= codeCount %>" ; ▁</ script > ▁</ form > ▁<% ▁} ▁else ▁{ ▁String ▁startDate ▁= ▁new ▁ SimpleDateFormat (" MM / dd / yyyy "). format ( new ▁Date ()); ▁String ▁endDate ▁= ▁new ▁ SimpleDateFormat (" MM / dd / yyyy "). format ( new ▁Date ()); ▁%> ▁< form ▁action =" monitor AdverseEvents . jsp " ▁method =" post "> ▁< table ▁class =" f Table " ▁align =" center "> ▁< tr ▁class =" subHeader "> ▁< td > Start ▁Date :</ td > ▁< td > ▁< input ▁name =" startDate " ▁value ="<%= startDate %>" ▁size ="10"> ▁< input ▁type = button ▁value =" Select ▁Date " "> ▁</ td > ▁< td > End ▁Date :</ td > ▁< td > ▁< input ▁name =" endDate " ▁value ="<%= endDate %>" ▁size ▁= ▁" 10 "> ▁< input ▁type = button ▁value =" Select ▁Date "> ▁</ td > ▁</ tr > ▁</ table > ▁< br ▁/> ▁< br ▁/> ▁< div ▁align =" center "> ▁< input ▁type =" submit " ▁value =" Prescriptions " ▁name =" prescriptions " ▁/> ▁< input ▁type =" submit " ▁value =" Immunizations " ▁name =" immunization s " ▁/> ▁</ div > ▁< br ▁/> ▁</ form > ▁<% ▁} ▁%> ▁<%@ include ▁file ="/ f ooter . jsp " ▁%>